<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MCD • Home</title>

  <!-- Favicon opdateres dynamisk, men vi har et sikkert fallback -->
  <link id="favicon" rel="icon" href="/favicon_boosted.ico?v=3" type="image/x-icon" />

  <!-- Supabase -->
  <link rel="preconnect" href="https://unpkg.com" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    *,*::before,*::after{ box-sizing:border-box }
    html{ font-size:16px }
    body{
      margin:0; min-height:100vh; display:flex; flex-direction:column;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:#fff; overflow-x:hidden;
      /* Lagdelt baggrund (ens med About) */
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.14)),
        image-set(var(--bg-1x) 1x, var(--bg-2x) 2x),
        var(--bg);
      background-repeat:no-repeat,no-repeat,no-repeat;
      background-size:auto,cover,auto;
      background-attachment:fixed,fixed,fixed;
      background-position:center center, center top, center center;
    }
    @media (max-width:900px){ body{ background-attachment:scroll,scroll,scroll } }

    :root{
      --wrap: 1680px;
      --edge: 24px;
      --gap: 18px;

      --nav-gap:14px; --nav-pad-x:14px; --nav-pad-y:8px;
      --nav-text:#fff; --nav-bg:#0d0f12; --nav-border:#2a2f36;
      --nav-hover-bg:#151517; --nav-hover-border:#444; --nav-active:#5aa9ff;

      --card:#0b0f15; --bd:#222a33; --muted:#cfd3d7; --shadow:0 16px 40px rgba(0,0,0,.45);

      --bg:#061a2b;
      --bg-image:url('https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public/backgrounds/ocean.png');
      --bg-1x: var(--bg-image);
      --bg-2x: var(--bg-image);
    }

    /* NAV + brand */
    .site-nav{ position:sticky; top:0; z-index:1000; padding:14px 0; }
    .nav-inner{ max-width:var(--wrap); margin:0 auto; padding:0 var(--edge); display:flex; align-items:center; gap:14px }
    .brand{
      display:inline-flex; align-items:center; gap:10px; padding:6px 8px; border-radius:12px; text-decoration:none; color:#fff;
      background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.08);
    }
    .brand img{ height:26px; width:auto; display:block }
    .brand .txt{ font-weight:800; letter-spacing:.2px }
    nav{
      margin-left:auto; display:flex; gap:var(--nav-gap); align-items:center; flex-wrap:wrap;
    }
    nav a{
      display:inline-flex; align-items:center; justify-content:center;
      padding:var(--nav-pad-y) var(--nav-pad-x);
      color:var(--nav-text); background:var(--nav-bg); border:1px solid var(--nav-border);
      border-radius:12px; text-decoration:none; opacity:.96; box-shadow:inset 0 1px 0 rgba(255,255,255,.06)
    }
    nav a:hover{ background:var(--nav-hover-bg); border-color:var(--nav-hover-border) }
    nav a[aria-current="page"]{
      border-color:var(--nav-active);
      box-shadow:0 0 0 2px color-mix(in srgb, var(--nav-active) 26%, transparent) inset;
    }

    /* Sociale links (venstre side) */
    .social-menu{ position:fixed; top:110px; left:16px; display:flex; flex-direction:column; gap:10px; z-index:999 }
    .social-menu a{
      display:flex; align-items:center; justify-content:center;
      width:42px; height:42px; background:rgba(0,0,0,.7);
      border:1px solid #2a2f36; border-radius:8px; text-decoration:none;
      transition:background .15s, transform .15s;
    }
    .social-menu a:hover{ background:rgba(0,0,0,.85); transform:translateY(-2px) }
    .social-menu a img{ width:22px; height:22px }

    /* Layout */
    .wrap{ max-width:var(--wrap); margin:0 auto; padding:18px var(--edge) 32px }

    /* Hero */
    .hero{
      display:grid; grid-template-columns: 1.2fr 1fr; gap:24px; align-items:center;
    }
    .card{
      background:var(--card); border:1px solid var(--bd); border-radius:16px; padding:18px; box-shadow:var(--shadow)
    }
    .hero h1{ font-size:clamp(24px, 4.2vw, 42px); margin:.1rem 0 .4rem }
    .hero p{ color:var(--muted); margin:.25rem 0 .6rem; font-size:1.05rem }
    .cta-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:.5rem }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border-radius:12px; text-decoration:none; cursor:pointer;
      background:#0d0f12; border:1px solid #2a2f36; color:#fff; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
    }
    .btn.primary{ background:linear-gradient(135deg,#FFD700,#DAA520); color:#1c2630; border-color:#865c10; font-weight:800 }

    /* Sektioner */
    .grid{ display:grid; grid-template-columns: repeat(3, minmax(260px,1fr)); gap:18px; margin-top:22px }
    .muted{ color:var(--muted) }

    /* Footer */
    .site-footer{
      margin-top:auto; padding:12px 16px; text-align:center;
      background:rgba(0,0,0,.75); border-top:1px solid rgba(255,255,255,.06);
    }

    /* Mobil */
    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
    }
    @media (max-width: 640px){
      .social-menu{ left:10px; top:96px }
      .brand img{ height:22px }
    }
  </style>
</head>
<body>
  <!-- NAV + Brand -->
  <header class="site-nav">
    <div class="nav-inner">
      <a href="/" class="brand" aria-label="MCD forside">
        <img id="brand-logo" alt="MCD logo" />
        <span class="txt">MCD</span>
      </a>
      <nav>
        <a href="/" aria-current="page" data-text="common:nav_home">Home</a>
        <a href="/about" data-text="common:nav_about">About</a>
        <a href="/roadmap" data-text="common:nav_roadmap">Roadmap</a>
        <a href="/reports" data-text="common:nav_reports">Reports</a>
      </nav>
    </div>
  </header>

  <!-- Sociale links -->
  <div class="social-menu" id="social-menu" aria-label="Sociale medier"></div>

  <!-- INDHOLD -->
  <main class="wrap">
    <!-- HERO -->
    <section class="hero">
      <article class="card">
        <div class="ribbon" style="display:inline-block;margin:-2px 0 8px;padding:4px 10px;border-radius:999px;font-size:12px;background:#102414;border:1px solid #1d3d22;color:#baf7c9;box-shadow:inset 0 1px 0 rgba(255,255,255,.06)">
          <span data-text="home:ribbon">NYHED: 25% hotelrabat</span>
        </div>
        <h1 data-text="home:title">MadaCoin – Development in Madagascar</h1>
        <p class="muted" data-text="home:subtitle">Donationer til skoler, solenergi og lokale jobs — med fuld gennemsigtighed.</p>
        <div class="cta-row">
          <a class="btn primary" href="/buy" data-text="home:cta_primary">Støt med MCD</a>
          <a class="btn" href="/reports" data-text="home:cta_secondary">Se rapporter</a>
        </div>
      </article>

      <aside class="card">
        <h3 data-text="home:side_title">Hvorfor MCD?</h3>
        <p class="muted" data-text="home:side_body">
          MCD er en donator-token, der finansierer konkrete projekter: boliger, skoler, vand og energi.
          Alt er spor­bart — fra donation til udført arbejde.
        </p>
      </aside>
    </section>

    <!-- 3 kolonne teaser (kan udfyldes fra site_text senere) -->
    <section class="grid">
      <article class="card">
        <h3 data-text="home:box1_title">Skoler & uddannelse</h3>
        <p class="muted" data-text="home:box1_body">Bygning, drift og praktikpladser i værkstederne.</p>
      </article>
      <article class="card">
        <h3 data-text="home:box2_title">Energi & vand</h3>
        <p class="muted" data-text="home:box2_body">Sol-mini-grids, batterier, drikkevand og rensning.</p>
      </article>
      <article class="card">
        <h3 data-text="home:box3_title">Jobs & gennemsigtighed</h3>
        <p class="muted" data-text="home:box3_body">Lokale leverandører først — med åbne budgetter.</p>
      </article>
    </section>
  </main>

  <footer class="site-footer">
    <span data-text="common:footer">© 2025 MadaCoin. All rights reserved.</span>
  </footer>

  <script>
    /* ===== Supabase klient ===== */
    const SUPABASE_URL = "https://byrlebjwknppjbtbkozt.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5cmxlYmp3a25wcGpidGJrb3p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjcyNjYsImV4cCI6MjA2NzM0MzI2Nn0.3aoQMQgmxXouUfpqrwfSgcUgedjZEue6s3ZkGoqvQYY";
    const sb = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON) : null;

    /* Aktiv menumarkering */
    (function markActive(){
      try{
        const here = location.pathname.replace(/\/index\.html?$/,'/');
        document.querySelectorAll('header nav a').forEach(a=>{
          const to = a.getAttribute('href');
          if (to === here || (here === '/' && to === '/')) a.setAttribute('aria-current','page');
          else a.removeAttribute('aria-current');
        });
      }catch(e){}
    })();

    /* Site-tekster (common + home) */
    (async function(){
      if(!sb) return;
      try{
        const { data } = await sb.from('site_text').select('page,key,value,content,project,is_active')
          .in('page',['common','home']).eq('project','MCD').eq('is_active',true);
        const dict={};
        (data||[]).forEach(r=>{
          const v = (r.value ?? r.content ?? '').toString();
          if(v) dict[`${r.page}:${r.key}`]=v;
        });
        document.querySelectorAll('[data-text]').forEach(el=>{
          const k=el.getAttribute('data-text'); if(dict[k]!=null) el.innerHTML=dict[k];
        });
      }catch(e){ console.warn('[home] site_text', e); }
    })();

    /* Baggrund pr. side (site_settings) */
    async function applyBackgroundForPage(pageKey='home'){
      if(!sb) return;
      try{
        const keys=[`bg_${pageKey}_1x`,`bg_${pageKey}_2x`,`bg_default_1x`,`bg_default_2x`];
        const { data } = await sb.from('site_settings').select('key,value').in('key', keys);
        const map = Object.fromEntries((data||[]).map(r=>[r.key,r.value]));
        const one = map[`bg_${pageKey}_1x`] || map['bg_default_1x'] || '';
        const two = map[`bg_${pageKey}_2x`] || map['bg_default_2x'] || '';
        if(one) document.body.style.setProperty('--bg-1x', `url("${one}")`);
        if(two) document.body.style.setProperty('--bg-2x', `url("${two}")`);
      }catch(e){ console.warn('[home] background', e); }
    }
    applyBackgroundForPage('home');

    /* Brand: logo + favicon fra site_settings */
    (async function applyBranding(){
      if(!sb) return;
      try{
        const keys = [
          'logo_mcd_nav','logo_nav_mcd',      // nav wordmark
          'logo_mcd_mark','logo_mark_mcd',    // emblem/mark
          'favicon_mcd'
        ];
        const { data } = await sb.from('site_settings').select('key,value').in('key', keys);
        const map = Object.fromEntries((data||[]).map(r=>[r.key,r.value]));

        // Vælg logo i fornuftig prioritet
        const logoUrl = map['logo_mcd_nav'] || map['logo_nav_mcd'] || map['logo_mcd_mark'] || map['logo_mark_mcd'] || '';
        const elLogo = document.getElementById('brand-logo');
        if(logoUrl && elLogo){ elLogo.src = logoUrl; elLogo.style.display='block'; }
        else if(elLogo){ elLogo.style.display='none'; } // vis kun "MCD" tekst

        // Favicon
        const fav = map['favicon_mcd'];
        if(fav){
          const link = document.getElementById('favicon');
          if(link) link.href = fav;
        }
      }catch(e){ console.warn('[home] branding', e); }
    })();

    /* Sociale links fra DB (samme som About) */
    function normalizeUrl(u){ if(!u) return null; const t=u.trim(); return /^https?:\/\//i.test(t)?t:'https://'+t }
    function iconUrlFor(p){
      if(!sb) return null;
      const name=p.charAt(0).toUpperCase()+p.slice(1).toLowerCase();
      const {data}=sb.storage.from('social.icons').getPublicUrl(`${name}.svg`);
      return data?.publicUrl||null
    }
    function fallbackIconUrl(){
      if(!sb) return '';
      const {data}=sb.storage.from('social.icons').getPublicUrl('Globe.svg');
      return data?.publicUrl||''
    }
    async function renderSocialLinks(){
      const el=document.getElementById('social-menu'); if(!el||!sb) return;
      el.innerHTML='';
      const {data}=await sb.from('social_links').select('platform,url,is_active,sort_order')
        .eq('is_active',true).order('sort_order',{ascending:true});
      const globe=fallbackIconUrl();
      (data||[]).filter(r=>r.url&&r.url.trim()!=='').forEach(r=>{
        const a=document.createElement('a'); const href=normalizeUrl(r.url); if(!href) return;
        a.href=href; a.target='_blank'; a.rel='noopener noreferrer'; a.title=r.platform; a.setAttribute('aria-label',r.platform);
        const img=document.createElement('img'); img.src=iconUrlFor(r.platform)||globe; img.onerror=()=>{img.src=globe}; a.appendChild(img); el.appendChild(a);
      });
    }
    window.addEventListener('load', renderSocialLinks);
  </script>
</body>
</html>
