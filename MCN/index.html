<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>MadaCoin MCN</title>
  <meta name="description" content="MadaCoin (MCN) – værditokenet i MadaCoin økosystemet. Live-graf, videoer og information.">
  <link id="favicon" rel="icon" href="/favicon_boosted.ico?v=1" type="image/x-icon">

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    *,*::before,*::after{ box-sizing:border-box }
    html,body{ height:100% }

    :root{
      /* Lærred + kolonner */
      --container: 1480px;
      --left-col: 520px;
      --mid-col: clamp(420px, 34vw, 520px);   /* giver plads til centreret YouTube */
      --right-col: clamp(480px, 36vw, 520px);

      /* Gutter (vi reducerer den markant) */
      --grid-gap: clamp(10px, 1.6vw, 16px);

      /* Nav */
      --edge:24px;
      --nav-gap:14px; --nav-px:14px; --nav-py:8px;
      --nav-bg:#0d0d0f; --nav-b:#333; --nav-hover:#151517; --nav-active:#5aa9ff;

      /* Social + base */
      --social-top:106px;
      --base-top:#eff3fb;
      --base-bot:#e2ebf7;

      /* Baggrund (fallback) */
      --bg:#061a2b;
      --bg-image:url('https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public/backgrounds/ocean.png');
      --bg-1x: var(--bg-image);
      --bg-2x: var(--bg-image);
      --bg-x: 0px;
      --bg-y: 0px;
    }

    /* ===== BODY / BG ===== */
    body{
      display:flex; flex-direction:column; margin:0; color:#fff;
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.14)),
        image-set(var(--bg-1x) 1x, var(--bg-2x) 2x),
        linear-gradient(var(--base-top), var(--base-bot));
      background-repeat: no-repeat, no-repeat, no-repeat;
      background-size: auto, cover, auto;
      background-attachment: fixed, fixed, fixed;
      background-position:
        center center,
        calc(50% + var(--bg-x)) calc(0% + var(--bg-y)),
        center center;
      overflow-x:hidden;
    }
    main{ flex:1 }

    /* ===== NAV ===== */
    .site-nav{ position:sticky; top:0; z-index:1000; padding:20px 0 }
    .nav{ display:flex; gap:var(--nav-gap); padding-left:var(--edge) }
    .nav a{
      padding:var(--nav-py) var(--nav-px); border-radius:12px; text-decoration:none;
      background:var(--nav-bg); border:1px solid var(--nav-b); color:#fff
    }
    .nav a:hover{ background:var(--nav-hover) }
    .nav a[aria-current="page"]{ border-color:var(--nav-active) }

    /* ===== SOCIAL ===== */
    .social-menu{ position:fixed; top:var(--social-top); left:var(--edge); display:flex; flex-direction:column; gap:10px; z-index:999 }
    .social-menu a{ width:42px; height:42px; display:grid; place-items:center; background:rgba(0,0,0,.7); border-radius:8px; text-decoration:none }
    .social-menu a img{ width:22px; height:22px }

    /* ===== SCENE som 3-kolonne grid ===== */
    .stage{
      max-width:var(--container);
      margin:18px auto 26px;
      padding:0 16px;
      display:grid;
      grid-template-columns: var(--left-col) var(--mid-col) var(--right-col);
      grid-auto-rows: auto;
      gap: var(--grid-gap);
      align-items:start;
    }

    /* Venstre kolonne – Hero + (valgfrit) brand */
    .hero{
      background:#0b0b0c; border:1px solid #2a2a2a; border-radius:16px;
      box-shadow:0 12px 26px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.06);
      padding:16px 18px; grid-column:1; grid-row:1;
    }
    .hero .ribbon{ display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; background:#102414; border:1px solid #1d3d22; color:#baf7c9; margin-bottom:6px }
    .hero h1{ font-size:clamp(22px,2.6vw,26px); margin:0 0 .5rem }
    .hero .sub{ color:#cfd3d7; margin:.25rem 0 .5rem }
    .hero .points{ display:flex; flex-wrap:wrap; gap:6px 8px; margin:.5rem 0 .75rem }
    .hero .pt{ padding:6px 10px; border-radius:999px; background:#0d0d0f; border:1px solid #333; font-size:.9rem }
    .hero .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
    .hero .btn{ padding:9px 14px; border-radius:12px; text-decoration:none; background:#0d0d0f; border:1px solid #333; color:#fff }
    .hero .btn.primary{ background:linear-gradient(135deg,#FFD700,#DAA520); color:#1c2630 }

    /* Brand (kamæleonen) uden sort baggrund */
    .brand-hero{
      grid-column:1; grid-row:2;
      padding:0; background:transparent; border:none; box-shadow:none;
      display:flex; align-items:center; justify-content:center;
    }
    .brand-hero img{ display:block; width:min(420px, 92%); height:auto; object-fit:contain; filter: drop-shadow(0 8px 18px rgba(0,0,0,.45)); }

    /* Midterkolonne – Mønt + YouTube */
    .coins{ grid-column:2; grid-row:1; display:flex; justify-content:center }
    .coin{
      background:#fff8dc; padding:10px; border-radius:15px; width:240px; text-align:center;
      box-shadow:0 0 12px rgba(0,0,0,.1); border:2px solid #e5c100
    }
    .coin img{ width:200px; height:200px; border-radius:10px; margin-bottom:8px; object-fit:cover }
    .coin-description{ font-size:.9rem; color:#333; margin:0 0 8px }
    .button{ background:linear-gradient(135deg,#FFD700,#DAA520); color:#004d73!important; padding:9px 14px; border:none; border-radius:6px; font-weight:700; cursor:pointer }
    .button:hover{ background:linear-gradient(135deg,#FFC107,#B8860B) }

    .yt-wrap{ grid-column:2; grid-row:2; width:100%; margin:8px 0 0 0 }
    #yt-player{ position:relative; padding-top:56.25%; border:2px solid #222; border-radius:14px; overflow:hidden; background:#000 }
    #yt-thumbs{ display:grid; grid-template-columns:repeat(auto-fill,minmax(110px,1fr)); gap:12px; margin-top:12px }

    /* Højre kolonne – Live graf (samme top som Hero) */
    .mcn-panel{
      grid-column:3; grid-row:1;
      background:#0b0b0c; border:1px solid #2a2a2a; border-radius:16px;
      padding:16px 18px; min-height:420px;
      box-shadow:0 12px 26px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.06);
    }
    .mcn-panel h3{ margin:0 0 10px }
    #mcn-chart-wrap{ border:1px solid #222; border-radius:12px; overflow:hidden; background:#070707 }

    footer{ margin-top:auto; text-align:center; padding:16px; background:#e4e6c5; color:#000 }

    /* Responsiv */
    @media (max-width:1150px){
      .stage{
        grid-template-columns: 1fr;
      }
      .hero,.brand-hero,.coins,.mcn-panel,.yt-wrap{ grid-column:1; }
      .coins{ justify-content:flex-start }
    }

    /* ===== Kun ønskede ændringer ===== */
    /* 1) Gennemsigtig baggrund for Hero + Live-graf, men behold rammer/skygger/layout */
    .hero{ background:transparent !important; }
    .mcn-panel{ background:transparent !important; }
    #mcn-chart-wrap{ background:transparent !important; }

    /* 2) Sort tekst for de præcist nævnte elementer */
    .hero h1,
    .hero .sub,
    .mcn-panel h3,
    #mcn-chart-fallback{
      color:#000 !important;
    }
  </style>
</head>
<body>
  <!-- NAV (kun Hjem + Om) -->
  <header class="site-nav">
    <nav class="nav">
      <a href="/index" aria-current="page">Hjem</a>
      <a href="/about">Om</a>
    </nav>
  </header>

  <main>
    <!-- Sociale links -->
    <div class="social-menu" id="social-menu"></div>

    <!-- 3-kolonne scene -->
    <section class="stage">
      <!-- Venstre: MCN-Hero -->
      <section class="hero" id="mcn-hero">
        <div class="ribbon">Opdatering: MCN live-graf & videoer</div>
        <h1>MadaCoin (MCN) – værditokenet</h1>
        <p class="sub">MCN er det kommercielle token i MadaCoin-økosystemet (ikke donation). Følg kursen i realtid og se vores seneste videoer.</p>
        <div class="points">
          <span class="pt">Polygon</span>
          <span class="pt">Utility & økosystem</span>
          <span class="pt">Transparens</span>
        </div>
        <div class="btns">
          <button class="btn primary" id="buy-mcn">Køb / handl MCN</button>
          <a class="btn" href="/about">Læs om MCN</a>
        </div>
      </section>

      <!-- Brand (uden mørk plade) -->
      <section class="brand-hero" aria-label="MCN logo">
        <img id="brand-hero-img" alt="MCN logo" />
      </section>

      <!-- Midten: Mønt -->
      <section class="coins">
        <div class="coin">
          <img id="coinC" alt="MadaCoin (MCN)" />
          <p class="coin-description">MadaCoin (MCN) – værditokenet i økosystemet.</p>
          <button class="button" id="buy-mcn-2">Køb / handl MCN</button>
        </div>
      </section>

      <!-- Højre: MCN live-graf (samme højde som Hero) -->
      <aside class="mcn-panel" id="mcn-panel">
        <h3>MCN – live graf</h3>
        <div id="mcn-chart-wrap">
          <iframe id="mcn-chart" title="MCN live chart" style="display:none;width:100%;height:420px;border:0;"></iframe>
          <div id="mcn-chart-fallback" style="padding:12px;color:#cfd3d7;">
            Indsæt grafen via Supabase: tabel <code>site_text</code>, sæt <code>page=home</code>, <code>key=mcn_chart_url</code> til en iframe-venlig URL
            (f.eks. Dexscreener/Dextools embed). Når den er sat, vises grafen automatisk her.
          </div>
        </div>
      </aside>

      <!-- YouTube: centreres under Mønt-sektionen -->
      <section id="yt-section" class="yt-wrap">
        <div id="yt-player"></div>
        <div id="yt-thumbs"></div>
      </section>
    </section>
  </main>

  <footer>© 2025 MadaCoin. All rights reserved.</footer>

  <script>
    /* ===== Supabase setup ===== */
    const SUPABASE_URL="https://byrlebjwknppjbtbkozt.supabase.co";
    const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5cmxlYmp3a25wcGpidGJrb3p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjcyNjYsImV4cCI6MjA2NzM0MzI2Nn0.3aoQMQgmxXouUfpqrwfSgcUgedjZEue6s3ZkGoqvQYY";
    const sb = window.supabase ? window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON) : null;

    /* Aktiv menu */
    (function markActive(){
      try{
        const here = location.pathname.replace(/\/index\.html?$/,'/index');
        document.querySelectorAll('header .nav a').forEach(a=>{
          if(a.getAttribute('href')===here) a.setAttribute('aria-current','page');
          else a.removeAttribute('aria-current');
        });
      }catch(e){}
    })();

    /* Baggrund fra site_settings */
    async function applyBackgroundForPage(pageKey='mcn_home'){
      if(!sb) return;
      try{
        const keys=[`bg_${pageKey}_1x`,`bg_${pageKey}_2x`,`bg_mcn_default_1x`,`bg_mcn_default_2x`,`bg_default_1x`,`bg_default_2x`];
        const { data } = await sb.from('site_settings').select('key,value').in('key', keys);
        const map = Object.fromEntries((data||[]).map(r=>[r.key,r.value]));
        const one = map[`bg_${pageKey}_1x`] || map['bg_mcn_default_1x'] || map['bg_default_1x'] || '';
        const two = map[`bg_${pageKey}_2x`] || map['bg_mcn_default_2x'] || map['bg_default_2x'] || '';
        if(one) document.body.style.setProperty('--bg-1x', `url("${one}")`);
        if(two) document.body.style.setProperty('--bg-2x', `url("${two}")`);
      }catch(e){ console.warn('[mcn] background', e); }
    }

    /* BUY / ON-RAMP for MCN */
    async function openBuyMCN(){
      try{
        if(!sb){ alert("Konfiguration hentes fra Supabase senere."); return; }
        const { data, error } = await sb
          .from('buy_config').select('url, provider, wallet, asset')
          .eq('key','MCN').single();
        if(error || !data){ alert("Købslink for MCN er ikke sat endnu. Udfyld buy_config (key=MCN) i Supabase."); return; }
        if(data?.url){ window.open(data.url, "_blank"); return; }
        alert("Tilføj en gyldig URL i buy_config (key=MCN).");
      }catch(e){ alert("MCN-købsknappen aktiveres, når buy_config er sat."); }
    }

    /* Tekster & sociale links */
    async function loadSiteText(){
      if(!sb) return {};
      try{
        const { data } = await sb.from('site_text').select('page,key,value,content,project,is_active')
          .in('page',['common','home']).eq('project','MCN').eq('is_active',true);
        const dict={};
        (data||[]).forEach(r=>{
          const v = (r.value ?? r.content ?? '').toString();
          if(v) dict[`${r.page}:${r.key}`]=v;
        });
        document.querySelectorAll('[data-text]').forEach(el=>{
          const k=el.getAttribute('data-text'); if(dict[k]!=null) el.innerHTML=dict[k];
        });
        return dict;
      }catch{ return {}; }
    }
    function normalizeUrl(u){ if(!u) return null; const t=u.trim(); return /^https?:\/\//i.test(t)?t:'https://'+t }
    function iconUrlFor(p){ if(!sb) return null; const name=p.charAt(0).toUpperCase()+p.slice(1).toLowerCase(); const {data}=sb.storage.from('social.icons').getPublicUrl(`${name}.svg`); return data?.publicUrl||null }
    function fallbackIconUrl(){ if(!sb) return ''; const {data}=sb.storage.from('social.icons').getPublicUrl('Globe.svg'); return data?.publicUrl||'' }
    async function renderSocialLinks(){
      const el=document.getElementById('social-menu'); if(!el||!sb) return;
      el.innerHTML='';
      const {data}=await sb.from('social_links').select('platform,url,is_active,sort_order')
        .eq('is_active',true).order('sort_order',{ascending:true});
      const globe=fallbackIconUrl();
      (data||[]).filter(r=>r.url&&r.url.trim()!=='').forEach(r=>{
        const a=document.createElement('a'); const href=normalizeUrl(r.url); if(!href) return;
        a.href=href; a.target='_blank'; a.rel='noopener noreferrer'; a.title=r.platform; a.setAttribute('aria-label',r.platform);
        const img=document.createElement('img'); img.src=iconUrlFor(r.platform)||globe; img.onerror=()=>{img.src=globe}; a.appendChild(img); el.appendChild(a);
      });
    }

    /* Assets */
    const storeBase = `${SUPABASE_URL}/storage/v1/object/public`;
    const pub = (...p)=>`${storeBase}/${p.map(encodeURIComponent).join('/')}`;
    function setCoinImages(){
      const c=document.getElementById('coinC');
      if(c) c.src=pub('images','MadaCoin_C.png');
    }

    /* Branding fra bucket 'logo' (kamæleon + evt. favicon) */
    const LOGO_BUCKET='logo';
    const BRAND_EXTS=['svg','png','webp','jpg','jpeg'];
    const FAV_EXTS=['svg','png','ico'];
    function publicUrl(bucket,path){ if(!sb) return null; const {data}=sb.storage.from(bucket).getPublicUrl(path); return data?.publicUrl||null }
    function probeImage(url,timeoutMs=6000){
      return new Promise((resolve)=>{ if(!url) return resolve(null);
        const img=new Image(); let done=false; const finish=ok=>{ if(!done){ done=true; resolve(ok?url:null); } };
        const t=setTimeout(()=>finish(false),timeoutMs); img.onload=()=>{ clearTimeout(t); finish(true) }; img.onerror=()=>{ clearTimeout(t); finish(false) };
        const cb=Math.floor(Date.now()/(12*60*60*1000)); img.src=url+(url.includes('?')?`&cb=${cb}`:`?cb=${cb}`);
      });
    }
    async function firstExisting(baseName,exts){
      for(const ext of exts){ const u=publicUrl(LOGO_BUCKET,`${baseName}.${ext}`); if(await probeImage(u)) return u; }
      return null;
    }
    async function applyBrandingFromBucket(project='MCN'){
      if(!sb) return;
      const base=(project||'MCN').toUpperCase();
      const hero = await firstExisting(base,BRAND_EXTS);
      const fav  = await firstExisting(`${base}-favicon`,FAV_EXTS) || hero;
      const img=document.getElementById('brand-hero-img'); if(img && hero) img.src = hero;
      const link=document.getElementById('favicon'); if(link && fav) link.href = fav;
      if(img && !img.src){
        img.src=`data:image/svg+xml;utf8,`+encodeURIComponent(
          `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='220'>
            <rect width='100%' height='100%' rx='18' fill='transparent'/>
            <text x='50%' y='58%' text-anchor='middle' font-family='Segoe UI, Arial' font-size='84' font-weight='900' fill='#FFD700'>MCN</text>
          </svg>` );
      }
    }

    /* YouTube */
    function getYouTubeId(url){ if(!url) return null; try{ const u=new URL(url); if(u.hostname.includes('youtu.be')) return u.pathname.slice(1); if(u.searchParams.get('v')) return u.searchParams.get('v'); const m=url.match(/(?:embed|shorts)\/([a-zA-Z0-9_-]{6,})/); if(m) return m[1]; const seg=u.pathname.split('/').pop(); return seg&&seg.length>=6?seg:null }catch{return null} }
    function thumbUrl(id){ return `https://i.ytimg.com/vi/${id}/hqdefault.jpg` }
    function renderPlayer(id){
      const el=document.getElementById('yt-player');
      el.innerHTML=`<iframe src="https://www.youtube.com/embed/${id}" title="MadaCoin video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;"></iframe>`;
    }
    function renderThumbs(videos,active){
      const wrap=document.getElementById('yt-thumbs'); wrap.innerHTML='';
      videos.forEach(v=>{
        const id=v._id;
        const btn=document.createElement('button');
        btn.style.background='transparent';
        btn.style.border=id===active?'3px solid #f0b90b':'2px solid #333';
        btn.style.borderRadius='12px';
        btn.style.overflow='hidden';
        btn.style.cursor='pointer';
        btn.style.padding='0';
        btn.title=v.title||'Se video';
        btn.innerHTML=`<img src='${thumbUrl(id)}' alt='${v.title||"YouTube thumbnail"}' style="display:block;width:100%;height:100%;object-fit:cover;">`;
        btn.onclick=()=>{ renderPlayer(id); [...wrap.children].forEach(c=>c.style.border='2px solid #333'); btn.style.border='3px solid #f0b90b'; };
        wrap.appendChild(btn);
      });
    }
    async function initYouTube(){
      if(!sb){ document.getElementById('yt-section').style.display='none'; return; }
      const {data,error}=await sb.from('youtube_videos')
        .select('youtube_url,is_active,created_at,title,sort_order')
        .eq('is_active',true).not('youtube_url','is',null).neq('youtube_url','')
        .order('sort_order',{ascending:true,nullsFirst:false}).order('created_at',{ascending:false});
      if(error) return;
      const vids=(data||[]).map(v=>({...v,_id:getYouTubeId(v.youtube_url)})).filter(v=>v._id);
      if(!vids.length){ document.getElementById('yt-section').style.display='none'; return; }
      document.getElementById('yt-section').style.display='';
      renderPlayer(vids[0]._id); renderThumbs(vids,vids[0]._id);
    }

    /* MCN graf (iframe-URL fra Supabase site_text) */
    async function initMCNChart(){
      const frame=document.getElementById('mcn-chart');
      const fallback=document.getElementById('mcn-chart-fallback');
      if(!sb || !frame){ return; }
      try{
        let { data, error } = await sb.from('site_text')
          .select('value').eq('page','home').eq('key','mcn_chart_url').eq('project','MCN').maybeSingle();
        if(error || !data){
          ({ data } = await sb.from('site_text')
            .select('value').eq('page','home').eq('key','mcn_chart_url').maybeSingle());
        }
        const url = (data && data.value || '').trim();
        if(url){
          frame.src = url;
          frame.style.display = 'block';
          if(fallback) fallback.style.display = 'none';
        }
      }catch(e){}
    }

    /* Events */
    function attachActions(){
      const b1=document.getElementById('buy-mcn');
      const b2=document.getElementById('buy-mcn-2');
      if(b1) b1.addEventListener('click',openBuyMCN);
      if(b2) b2.addEventListener('click',openBuyMCN);
    }

    /* Init */
    window.addEventListener('load', async ()=>{
      await applyBackgroundForPage('mcn_home');

      /* === MCN-specifikt baggrundsbillede fra Supabase Storage (backgrounds/MadaCoin.png) === */
      try{
        const bg1 = publicUrl('backgrounds', 'MadaCoin.png');
        if (bg1) {
          document.body.style.setProperty('--bg-1x', `url("${bg1}")`);
          document.body.style.setProperty('--bg-2x', `url("${bg1}")`);
        }
        const bg2 = publicUrl('backgrounds', 'MadaCoin@2x.png');
        if (bg2) document.body.style.setProperty('--bg-2x', `url("${bg2}")`);
      }catch(e){ console.warn('[mcn] bg override', e); }
      /* === SLUT baggrunds-override === */

      await loadSiteText();
      await renderSocialLinks();
      setCoinImages();
      initYouTube();
      initMCNChart();
      await applyBrandingFromBucket('MCN');
      attachActions();
    });
  </script>
</body>
</html>
