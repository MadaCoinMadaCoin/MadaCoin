<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>MadaCoin</title>
  <meta name="description" content="MadaCoin støtter udvikling i Madagaskar gennem donationer og gennemsigtighed.">
  <link rel="icon" href="/favicon_boosted.ico?v=1" type="image/x-icon">

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    *,*::before,*::after{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      display:flex; flex-direction:column; margin:0; color:#fff;
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      background:#061a2b no-repeat center/cover fixed;
      background-image:url('https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public/backgrounds/ocean.png');
      overflow-x:hidden;
    }
    main{ flex:1 }

    :root{
      --edge:24px;
      --nav-gap:14px; --nav-px:14px; --nav-py:8px;
      --nav-bg:#0d0d0f; --nav-b:#333; --nav-hover:#151517; --nav-active:#5aa9ff;

      --container:1200px;

      /* PRO-PLADS (venstre kolonne udvidet) */
      --left-col:520px;        /* Hero+Graf bredde */
      --gap:88px;

      /* Sociale venstre-rail reference */
      --social-top:106px;      /* top for sociale ikoner (øverste ikon) */

      /* FINJUSTERING af vertikal placering ift. sociale knapper */
      /* Var -8px; nu -40px ≈ 50% mindre afstand (rykker Hero+Graf op) */
      --left-rail-nudge:-40px;

      /* Usynlig boks: placering af Hero+Graf (alignet til social-top + nudge) */
      --left-rail-top: calc(var(--social-top) + var(--left-rail-nudge));
      --left-rail-left: -260px;    /* stor afstand til mønter (vandret) */

      /* LÅS højre kolonne (Mønter+YouTube) – urørlig */
      --right-rail-left: 538px;
    }

    /* NAV */
    .site-nav{ position:sticky; top:0; z-index:1000; padding:20px 0 }
    .nav{ display:flex; gap:var(--nav-gap); padding-left:var(--edge) }
    .nav a{
      padding:var(--nav-py) var(--nav-px); border-radius:12px; text-decoration:none;
      background:var(--nav-bg); border:1px solid var(--nav-b); color:#fff
    }
    .nav a:hover{ background:var(--nav-hover) }
    .nav a[aria-current="page"]{ border-color:var(--nav-active) }

    /* Sociale links (fast venstre) */
    .social-menu{ position:fixed; top:var(--social-top); left:var(--edge); display:flex; flex-direction:column; gap:10px; z-index:999 }
    .social-menu a{ width:42px; height:42px; display:grid; place-items:center; background:rgba(0,0,0,.7); border-radius:8px; text-decoration:none }
    .social-menu a img{ width:22px; height:22px }

    /* SCENE */
    .stage{
      position:relative;
      max-width:var(--container);
      margin:18px auto 26px;
      padding:0 16px;
    }

    /* === USYNLIG BOKS OM HERO+GRAF (uafhængig placering) === */
    .left-rail-box{
      position:absolute;
      top:var(--left-rail-top);   /* <- justeret via --left-rail-nudge */
      left:var(--left-rail-left);
      width:var(--left-col);
      background:transparent;
      pointer-events:none;
      z-index:1;
    }
    .left-rail-box > *{ pointer-events:auto }

    /* Højre kolonne (Mønt + YouTube) — LÅST position */
    .right-rail{
      margin-left: var(--right-rail-left);
      position:relative;
      z-index:2;
    }

    /* Wrapper der låser YouTube til mønternes bredde */
    .right-stack{
      display:inline-block;       /* shrink-to-fit indholdets bredde (sat af .coins) */
      vertical-align:top;
    }

    /* COINS: inline-flex uden wrap, så bredden = 2 * coin + gap */
    .coins{
      display:inline-flex;
      flex-wrap:nowrap;
      gap:24px;
      align-items:flex-start;
    }
    .coin{
      background:rgba(255,248,220,.95); padding:10px; border-radius:15px; width:240px;
      text-align:center; box-shadow:0 0 12px rgba(0,0,0,.1); border:2px solid #e5c100
    }
    .coin img{ width:200px; height:200px; border-radius:10px; margin-bottom:8px; object-fit:cover }
    .coin-description{ font-size:.9rem; color:#333; margin:0 0 8px }
    .button{ background:linear-gradient(135deg,#FFD700,#DAA520); color:#004d73!important; padding:9px 14px; border:none; border-radius:6px; font-weight:700; cursor:pointer }
    .button:hover{ background:linear-gradient(135deg,#FFC107,#B8860B) }

    /* YOUTUBE følger bredden af .coins via .right-stack */
    .yt-wrap{ width:100%; margin:22px 0 0 0 }
    #yt-player{ position:relative; padding-top:56.25%; border:2px solid #222; border-radius:14px; overflow:hidden }
    #yt-thumbs{ display:grid; grid-template-columns:repeat(auto-fill,minmax(110px,1fr)); gap:12px; margin-top:12px }

    /* HERO */
    .hero{
      background:#0b0b0c; border:1px solid #2a2a2a; border-radius:16px;
      box-shadow:0 12px 26px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.06);
      padding:16px 18px;
    }
    .hero .ribbon{ display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; background:#102414; border:1px solid #1d3d22; color:#baf7c9; margin-bottom:6px }
    .hero h1{ font-size:clamp(22px,2.6vw,26px); margin:0 0 .5rem }
    .hero .sub{ color:#cfd3d7; margin:.25rem 0 .5rem }
    .hero .points{ display:flex; flex-wrap:wrap; gap:6px 8px; margin:.5rem 0 .75rem }
    .hero .pt{ padding:6px 10px; border-radius:999px; background:#0d0d0f; border:1px solid #333; font-size:.9rem }
    .hero .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
    .hero .btn{ padding:9px 14px; border-radius:12px; text-decoration:none; background:#0d0d0f; border:1px solid #333; color:#fff }
    .hero .btn.primary{ background:linear-gradient(135deg,#FFD700,#DAA520); color:#1c2630 }

    /* GRAF-BOKS — PRO-PLADS */
    .mcn-panel{
      margin-top:22px;
      background:rgba(0,0,0,.85); border:1px solid #2a2a2a; border-radius:16px;
      padding:16px 18px; min-height:400px;
      box-shadow:0 12px 26px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.06);
    }

    footer{ margin-top:auto; text-align:center; padding:16px; background:#e4e6c5; color:#000 }

    /* RESPONSIV */
    @media (max-width:1150px){
      .left-rail-box{ position:static; width:auto; pointer-events:auto }
      .right-rail{ margin-left:0 }
      .right-stack{ display:block }
      .coins{ display:flex; flex-wrap:wrap; justify-content:center }
      .stage{ padding:0 16px }
      .yt-wrap{ width:100%; margin:22px auto 0 auto }
    }
    @media (max-width:760px){
      .coin{ width:200px }
      .coin img{ width:170px; height:170px }
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="site-nav">
    <nav class="nav">
      <a href="/index.html" aria-current="page">Home</a>
      <a href="/madacoin.html">Om</a>
      <a href="/rapporter.html">Rapporter</a>
    </nav>
  </header>

  <main>
    <!-- Sociale links -->
    <div class="social-menu" id="social-menu"></div>

    <!-- Scene -->
    <section class="stage">
      <!-- Usynlig boks: KUN Hero + Graf (flyttes uafhængigt) -->
      <div class="left-rail-box">
        <section class="hero" id="home-hero">
          <div class="ribbon">NYHED: 25% hotelrabat til MCD &amp; MCN holders</div>
          <h1>Donér. Byg. Forandr Madagaskar.</h1>
          <p class="sub">MadaCoin gør donationer til skoler, solenergi og lokale jobs — med fuld gennemsigtighed.</p>
          <div class="points">
            <span class="pt">Skolebyggeri</span>
            <span class="pt">Solceller &amp; batterier</span>
            <span class="pt">Åbne rapporter</span>
          </div>
          <div class="btns">
            <button class="btn primary" id="hero-primary">Støt med MadaCoin</button>
            <a class="btn" href="/rapporter.html">Se rapporter</a>
          </div>
        </section>

        <aside class="mcn-panel" id="mcn-panel">
          <h3>Diverse grafer om MCN / Polygon</h3>
          <p>Alt der påvirker vores egen mønts værdi.</p>
          <p style="opacity:.9">Live visning, så vidt muligt.</p>
          <p style="opacity:.85">Boksen kan udvides nedad ved behov.</p>
        </aside>
      </div>

      <!-- Højre side: Mønter + YouTube (låst position og bredde) -->
      <div class="right-rail">
        <div class="right-stack">
          <section class="coins">
            <div class="coin">
              <img id="coinD" alt="MadaCoin Donation" />
              <p class="coin-description">Støt vores mission ved at købe MadaCoin Donation.</p>
              <button class="button" onclick="openTransak('MCD','0xa594586B04f1b6782EC906B49882EbD0E652a388')">Køb MadaCoin Donation</button>
            </div>
            <div class="coin">
              <img id="coinC" alt="MadaCoin" />
              <p class="coin-description">Investér i MadaCoin – fremtidens valuta for Madagaskar.</p>
              <button class="button" onclick="openTransak('MCN','DIN_MCN_KONTRAKT_ADRESSE')">Køb MadaCoin</button>
            </div>
          </section>

          <section id="yt-section" class="yt-wrap">
            <div id="yt-player"></div>
            <div id="yt-thumbs"></div>
          </section>
        </div>
      </div>
    </section>
  </main>

  <footer>© 2025 MadaCoin. All rights reserved.</footer>

  <script>
    const SUPABASE_URL="https://byrlebjwknppjbtbkozt.supabase.co";
    const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5cmxlYmp3a25wcGpidGJrb3p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjcyNjYsImV4cCI6MjA2NzM0MzI2Nn0.3aoQMQgmxXouUfpqrwfSgcUgedjZEue6s3ZkGoqvQYY";
    const sb = window.supabase ? window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON) : null;

    const TRANSAK_KEY="DIN_API_KEY";
    function openTransak(symbol,wallet){
      if(!TRANSAK_KEY||TRANSAK_KEY==="DIN_API_KEY"||(wallet&&wallet.includes("DIN_MCN_KONTRAKT_ADRESSE"))){
        alert("Køb-funktionen bliver aktiveret, når nøgle og kontrakt er sat."); return;
      }
      const url=`https://global.transak.com/?apiKey=${TRANSAK_KEY}&cryptoCurrencyCode=${symbol}&walletAddress=${wallet}&network=polygon&fiatCurrency=EUR&defaultPaymentMethod=credit_debit_card&themeColor=FFCC00`;
      window.open(url,"_blank","width=500,height=700");
    }

    async function loadSiteText(){
      if(!sb) return {};
      try{
        const { data, error } = await sb.from('site_text').select('page,key,value').in('page',['common','home']);
        if(error) return {};
        const dict={}; (data||[]).forEach(r=>dict[`${r.page}:${r.key}`]=r.value);
        document.querySelectorAll('[data-text]').forEach(el=>{
          const k=el.getAttribute('data-text'); if(dict[k]!=null) el.innerHTML=dict[k];
        });
        return dict;
      }catch{ return {}; }
    }

    /* Sociale links (original loader) */
    function normalizeUrl(u){ if(!u) return null; const t=u.trim(); return /^https?:\/\//i.test(t)?t:'https://'+t }
    function iconUrlFor(p){ const name=p.charAt(0).toUpperCase()+p.slice(1).toLowerCase(); const {data}=sb.storage.from('social.icons').getPublicUrl(`${name}.svg`); return data?.publicUrl||null }
    function fallbackIconUrl(){ const {data}=sb.storage.from('social.icons').getPublicUrl('Globe.svg'); return data?.publicUrl||'' }
    async function renderSocialLinks(){
      const el=document.getElementById('social-menu'); if(!el||!sb) return;
      el.innerHTML='';
      const {data,error}=await sb.from('social_links').select('platform,url,is_active,sort_order')
        .eq('is_active',true).order('sort_order',{ascending:true});
      if(error) return;
      const globe=fallbackIconUrl();
      (data||[]).filter(r=>r.url&&r.url.trim()!=='').forEach(r=>{
        const a=document.createElement('a'); const href=normalizeUrl(r.url); if(!href) return;
        a.href=href; a.target='_blank'; a.rel='noopener noreferrer'; a.title=r.platform; a.setAttribute('aria-label',r.platform);
        const img=document.createElement('img'); img.src=iconUrlFor(r.platform)||globe; img.onerror=()=>{img.src=globe};
        a.appendChild(img); el.appendChild(a);
      });
    }

    /* Coin-billeder */
    const storeBase="https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public";
    const pub=(...p)=>`${storeBase}/${p.map(encodeURIComponent).join('/')}`;
    function setCoinImages(){
      const c=document.getElementById('coinC'), d=document.getElementById('coinD');
      if(c) c.src=pub('images','MadaCoin_C.png');
      if(d) d.src=pub('images','MadaCoin_D.png');
    }

    /* YouTube */
    function getYouTubeId(url){ if(!url) return null; try{ const u=new URL(url); if(u.hostname.includes("youtu.be")) return u.pathname.slice(1); if(u.searchParams.get("v")) return u.searchParams.get("v"); const m=url.match(/(?:embed|shorts)\/([a-zA-Z0-9_-]{6,})/); if(m) return m[1]; const seg=u.pathname.split("/").pop(); return seg&&seg.length>=6?seg:null }catch{return null} }
    function thumbUrl(id){ return `https://i.ytimg.com/vi/${id}/hqdefault.jpg` }
    function renderPlayer(id){
      const el=document.getElementById("yt-player");
      el.innerHTML=`<iframe src="https://www.youtube.com/embed/${id}" title="MadaCoin video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;"></iframe>`;
    }
    function renderThumbs(videos,active){
      const wrap=document.getElementById("yt-thumbs"); wrap.innerHTML="";
      videos.forEach(v=>{
        const id=v._id;
        const btn=document.createElement("button");
        btn.style.background='transparent';
        btn.style.border=id===active?"3px solid #f0b90b":"2px solid #333";
        btn.style.borderRadius="12px";
        btn.style.overflow="hidden";
        btn.style.cursor="pointer";
        btn.style.padding="0";
        btn.title=v.title||"Se video";
        btn.innerHTML=`<img src="${thumbUrl(id)}" alt="${v.title||"YouTube thumbnail"}" style="display:block;width:100%;height:100%;object-fit:cover;">`;
        btn.onclick=()=>{
          renderPlayer(id);
          [...wrap.children].forEach(c=>c.style.border="2px solid #333");
          btn.style.border="3px solid #f0b90b";
        };
        wrap.appendChild(btn);
      });
    }
    async function initYouTube(){
      if(!sb){ document.getElementById("yt-section").style.display="none"; return; }
      const {data,error}=await sb.from("youtube_videos")
        .select("youtube_url,is_active,created_at,title,sort_order")
        .eq("is_active",true)
        .not("youtube_url","is",null).neq("youtube_url","")
        .order("sort_order",{ascending:true,nullsFirst:false})
        .order("created_at",{ascending:false});
      if(error) return;
      const vids=(data||[]).map(v=>({...v,_id:getYouTubeId(v.youtube_url)})).filter(v=>v._id);
      if(!vids.length){ document.getElementById("yt-section").style.display="none"; return; }
      document.getElementById("yt-section").style.display="";
      renderPlayer(vids[0]._id); renderThumbs(vids,vids[0]._id);
    }

    function attachHeroActions(){
      const btn=document.getElementById('hero-primary');
      if(btn){ btn.addEventListener('click',()=>openTransak('MCD','0xa594586B04f1b6782EC906B49882EbD0E652a388')) }
    }

    window.addEventListener('load', async ()=>{
      await loadSiteText();
      await renderSocialLinks();
      setCoinImages();
      initYouTube();
      attachHeroActions();
    });
  </script>
</body>
</html>
