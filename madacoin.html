<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Om MadaCoin</title>
  <link rel="preconnect" href="https://unpkg.com" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#061a2b;
      --bg-image:url('https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public/backgrounds/ocean.png');
      --text:#fff; --muted:#cfd3d7; --primary:#9ad4ff;
      --card:#0b0b0c; --card-border:#2a2a2a; --shadow:0 12px 26px rgba(0,0,0,.5); --radius:16px;
      --wrap:1200px; --gap:24px; --left-col:620px; --right-col:420px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:var(--text);
      background: var(--bg) no-repeat center/cover fixed;
      background-image: var(--bg-image);
    }
    @media (max-width:900px){ body{ background-attachment:scroll } }

    a{ color:var(--primary); text-decoration:none }
    a:hover{ text-decoration:underline }

    .wrap{ max-width:var(--wrap); margin:0 auto; padding:18px 24px }
    header{ border-bottom:1px solid rgba(255,255,255,.06); background:transparent }

    /* Nav = individuelle pills */
    nav{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
    nav a{
      color:#fff; padding:8px 14px; border-radius:12px;
      background:#0d0d0f; border:1px solid #333; text-decoration:none; opacity:.96;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    nav a:hover{ filter:brightness(1.08) }
    nav a.active{ border-color:#555; box-shadow: inset 0 1px 0 rgba(255,255,255,.12) }

    .social-menu{ display:flex; gap:12px; flex-wrap:wrap; margin-top:8px }
    .social-menu a{
      display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border-radius:999px; background:#121214; border:1px solid #2a2a2a
    }
    .social-menu a:hover{ filter:brightness(1.1) }

    /* 2-kolonne layout */
    .layout{
      max-width:var(--wrap); margin:0 auto; padding:24px;
      display:grid; grid-template-columns:var(--left-col) var(--right-col); gap:var(--gap);
    }
    @media (max-width:1100px){ :root{ --left-col:560px; --right-col:360px } }
    @media (max-width:980px){ .layout{ grid-template-columns:1fr } }

    .card{
      background:var(--card); border:1px solid var(--card-border); border-radius:var(--radius);
      box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.06)
    }
    .card.pad{ padding:18px }
    h1{ margin:10px 0 12px; font-size:clamp(22px,3.2vw,34px) }
    h2{ margin:0 0 10px; font-size:clamp(18px,2.2vw,22px) }
    .muted{ color:var(--muted) }

    /* Venstre kolonne */
    .org-left{ display:flex; flex-direction:column; gap:24px }
    .row{ display:flex; gap:16px; align-items:flex-start }
    @media (max-width:820px){ .row{ flex-direction:column } }
    .bio-card{ flex:1; min-width:240px }

    .person,.peer,.sub{ display:flex; flex-direction:column; align-items:center; gap:10px }

    /* Foto/Logo – ingen ramme uden rigtigt foto; ramme ved rigtigt foto */
    .photo{
      display:block;
      width:170px; height:170px; border-radius:8px;
      background:transparent; background-position:50% 50%; background-size:cover; background-repeat:no-repeat;
      border:1px solid transparent; box-shadow:0 0 0 rgba(0,0,0,0);
    }
    .photo.has-photo{ border-color:#2a2a2a; box-shadow:0 8px 22px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.04) }
    .photo.portrait{ background-position:50% 35% } /* skub udsnit lidt op på høje billeder */
    .sub .photo, .peer .photo{ width:120px; height:120px }

    .label{
      min-width:220px; text-align:center; padding:8px 14px; border-radius:999px;
      background:#0d0d0f; border:1px solid #333; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      line-height:1.2
    }
    .label .title{ opacity:.9; font-size:13px }

    /* Højre kolonne */
    .side-col{ display:flex; flex-direction:column; gap:24px }
    .side-card{ min-height:180px }

    /* Footer (slank) */
    .site-footer{
      margin-top:28px;
      padding:12px 16px;
      background:rgba(0,0,0,.75);
      border-top:1px solid rgba(255,255,255,.06);
      color:#fff; text-align:center;
    }
    .site-footer a{ color:#fff; text-decoration:underline }
  </style>
</head>
<body>
  <header class="wrap">
    <nav>
      <a href="/index.html" data-text="common:nav_home">Home</a>
      <a href="/madacoin.html" class="active" data-text="common:nav_about">Om</a>
      <a href="/rapporter.html" data-text="common:nav_reports">Rapporter</a>
    </nav>
    <div class="social-menu" id="social-menu"></div>
  </header>

  <div class="layout">
    <!-- VENSTRE: org + bio tæt ved billederne -->
    <section class="org-left">
      <!-- Række 1: Juliennes bio (venstre) + Julienne (højre) -->
      <div class="row" id="row-top">
        <article class="card pad bio-card" id="bio-top">
          <h2 data-text="about:bio_top_title">Direktør · profil</h2>
          <p class="muted" data-text="about:bio_top">…</p>
        </article>

        <div class="person" id="person-top">
          <div class="photo" id="photo-top" aria-label="Profilbillede"></div>
          <div class="label">
            <div class="name" id="name-top">Julienne</div>
            <div class="title" id="title-top">Ejer og Direktør</div>
          </div>
        </div>
      </div>

      <!-- Række 2: Thomas (venstre – med bio til venstre) + Revisor (højre) -->
      <div class="row" id="row-mid">
        <div class="peer-col" id="peercol-mid" style="display:flex;gap:16px;align-items:flex-start">
          <article class="card pad bio-card" id="bio-thomas">
            <h2 data-text="about:thomas_bio_title">Om Thomas</h2>
            <div class="muted" data-text="about:thomas_bio">…</div>
          </article>

          <div class="peer" id="peer-mid">
            <div class="photo" id="photo-mid"></div>
            <div class="label">
              <div class="name" id="name-mid">Thomas</div>
              <div class="title" id="title-mid">Adm. Direktør · Udvikler</div>
            </div>
          </div>
        </div>

        <div class="peer" id="peer-accounting">
          <div class="photo" id="photo-accounting"></div>
          <div class="label">
            <div class="name" id="name-accounting">Revision &amp; Regnskab</div>
            <div class="title" id="title-accounting">Partner</div>
          </div>
        </div>
      </div>

      <!-- Række 3: underroller (tre bokse) -->
      <div class="row">
        <div class="sub" id="sub-1">
          <div class="photo" id="photo-sub-1"></div>
          <div class="label">
            <div class="name" id="name-sub-1">Navn</div>
            <div class="title" id="title-sub-1">Rolle</div>
          </div>
        </div>
        <div class="sub" id="sub-2">
          <div class="photo" id="photo-sub-2"></div>
          <div class="label">
            <div class="name" id="name-sub-2">Navn</div>
            <div class="title" id="title-sub-2">Rolle</div>
          </div>
        </div>
        <div class="sub" id="sub-3">
          <div class="photo" id="photo-sub-3"></div>
          <div class="label">
            <div class="name" id="name-sub-3">Navn</div>
            <div class="title" id="title-sub-3">Rolle</div>
          </div>
        </div>
      </div>
    </section>

    <!-- HØJRE: tre sidebokse -->
    <aside class="side-col">
      <div class="card pad side-card" id="side-1">
        <h2 data-text="about:right_1_title">Vores version</h2>
        <div class="muted" data-text="about:right_1">…</div>
      </div>
      <div class="card pad side-card" id="side-2">
        <h2 data-text="about:right_2_title">opdelt</h2>
        <div class="muted" data-text="about:right_2">…</div>
      </div>
      <div class="card pad side-card" id="side-3">
        <h2 data-text="about:right_3_title">flere gange</h2>
        <div class="muted" data-text="about:right_3">…</div>
      </div>
    </aside>
  </div>

  <footer class="site-footer">
    <span data-text="common:footer">© 2025 MadaCoin. All rights reserved.</span>
  </footer>

  <script>
    (function init(){
      // Supabase client (valgfri – siden virker også uden)
      if (window.supabase?.createClient && window.SUPABASE_URL && window.SUPABASE_ANON) {
        window.sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON);
      } else {
        window.sb = null; // kør med statiske fallbacks
      }
    })();

    (async () => {
      "use strict";

      const sb = window.sb || null; // fortsæt også uden supabase

      // ---------- STATIC STORAGE BASE (fungerer altid) ----------
      // Brug dit projekt-id (samme som i baggrundsbilledet)
      const STATIC_PROJECT = 'byrlebjwknppjbtbkozt';
      const STATIC_STORAGE_BASE = `https://${STATIC_PROJECT}.supabase.co/storage/v1/object/public`;

      // Hvis SUPABASE_URL findes, brug den; ellers brug statisk base
      const STORAGE_BASE =
        (window.SUPABASE_URL && window.SUPABASE_URL.includes('supabase.co')
          ? window.SUPABASE_URL.replace(/\/+$/,'') + '/storage/v1/object/public'
          : STATIC_STORAGE_BASE);

      // ---------- PLACEHOLDER ----------
      let PLACEHOLDER = '';
      if (sb) {
        try{
          const { data } = await sb.from('settings')
            .select('site_title,favicon_svg_url,favicon_png_url,apple_touch_icon_url,theme_primary,bg_image_url,bg_color')
            .eq('id',1).maybeSingle();

          if (data){
            if (data.site_title) document.title = data.site_title;
            const ensure=(id,rel,extra={})=>{let el=document.getElementById(id);
              if(!el){el=document.createElement('link'); el.id=id; el.rel=rel; document.head.appendChild(el)}
              Object.assign(el,extra) };
            if (data.favicon_svg_url) ensure('fav-svg','icon',{type:'image/svg+xml',href:data.favicon_svg_url});
            if (data.favicon_png_url) ensure('fav-png','icon',{href:data.favicon_png_url,sizes:'any'});
            if (data.apple_touch_icon_url) ensure('apple-icon','apple-touch-icon',{href=data.apple_touch_icon_url});

            const root=document.documentElement;
            if (data.theme_primary) root.style.setProperty('--primary', data.theme_primary);
            if (data.bg_color) root.style.setProperty('--bg', data.bg_color);
            if (data.bg_image_url) root.style.setProperty('--bg-image', `url('${data.bg_image_url}')`);

            PLACEHOLDER = data.favicon_png_url || data.favicon_svg_url || data.apple_touch_icon_url || '';
          }
        }catch(e){ console.warn('[about] settings:', e); }
      }

      // Fallback placeholder (MC-mønt i SVG) hvis intet favicon
      if (!PLACEHOLDER){
        PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(
          `<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256">
             <defs><radialGradient id="g" cx="50%" cy="40%" r="60%">
               <stop offset="0%" stop-color="#ffe28a"/><stop offset="60%" stop-color="#f7c14b"/><stop offset="100%" stop-color="#b47d17"/>
             </radialGradient></defs>
             <circle cx="128" cy="128" r="118" fill="url(#g)" stroke="#6b4a0e" stroke-width="6"/>
             <text x="50%" y="55%" text-anchor="middle" font-family="Segoe UI,Arial" font-size="88" font-weight="700" fill="#2b1b05">MC</text>
           </svg>`
        );
      }

      // ---------- Hjælpere ----------
      const fallbackBySlot = (slot) => {
        if (slot === 'top')        return `${STORAGE_BASE}/people/Owner.jpg`;
        if (slot === 'mid')        return `${STORAGE_BASE}/people/ADM.jpg`;
        if (slot === 'accounting') return `${STORAGE_BASE}/people/Revision.jpg`;
        return '';
      };

      const showPhoto = (elId, slot, url) => {
        const el = document.getElementById(elId);
        if (!el) return;

        const fallback = fallbackBySlot(slot);
        const hasReal = !!(url && String(url).trim());
        const chosen = hasReal ? url : (fallback || PLACEHOLDER);

        el.style.backgroundImage = `url('${chosen}')`;

        // Portræt-detektion
        const img = new Image();
        img.onload = () => {
          if (img.naturalHeight > img.naturalWidth * 1.15) el.classList.add('portrait');
          else el.classList.remove('portrait');
        };
        img.src = chosen;

        // Rammelogik: kun ramme ved rigtigt billede
        let addFrame = hasReal;
        if (!hasReal && slot === 'accounting' && fallback) addFrame = false; // Revision.jpg = placeholder
        if (!hasReal && !fallback) addFrame = false;                         // MC coin placeholder

        el.classList.toggle('has-photo', addFrame);
      };

      const setText = (id, val) => { const el=document.getElementById(id); if (el && val) el.textContent = val; };

      // ---------- Tekster (common + about) ----------
      if (sb) {
        try{
          const { data } = await sb.from('site_text').select('page,key,value').in('page',['common','about']);
          if (data){
            const dict=Object.fromEntries(data.map(r=>[`${r.page}:${r.key}`,r.value]));
            document.querySelectorAll('[data-text]').forEach(el=>{
              const k=el.getAttribute('data-text'); if (dict[k]) el.innerHTML = dict[k];
            });
          }
        }catch(e){ console.warn('[about] site_text:', e); }
      }

      // ---------- Personer/partnere ----------
      if (sb) {
        try{
          const { data: people } = await sb.from('org_people')
            .select('slot,name,title,photo_url,bio,partner_id')
            .in('slot',['top','mid','accounting','sub1','sub2','sub3']);

          const partnerIds = [...new Set((people||[]).map(p=>p.partner_id).filter(Boolean))];
          let partnersById = {};
          if (partnerIds.length){
            const { data: partners } = await sb.from('partners')
              .select('id,name,website,logo_url,logo_alt,category,active')
              .in('id', partnerIds);
            partnersById = Object.fromEntries((partners||[]).map(x=>[x.id,x]));
          }

          const bySlot = Object.fromEntries((people||[]).map(x=>[x.slot,x]));

          // Julienne
          (function(){
            const p = bySlot.top || {};
            showPhoto('photo-top', 'top', p.photo_url);
            setText('name-top',  p.name  || document.getElementById('name-top').textContent);
            setText('title-top', p.title || document.getElementById('title-top').textContent);
            if (p.bio){
              const el = document.querySelector('#bio-top [data-text="about:bio_top"]');
              if (el) el.innerHTML = p.bio;
            }
          })();

          // Thomas
          (function(){
            const p = bySlot.mid || {};
            showPhoto('photo-mid', 'mid', p.photo_url);
            setText('name-mid',  p.name  || document.getElementById('name-mid').textContent);
            setText('title-mid', p.title || document.getElementById('title-mid').textContent);
            if (p.bio){
              const el = document.querySelector('#bio-thomas [data-text="about:thomas_bio"]');
              if (el) el.innerHTML = p.bio;
            }
          })();

          // Accounting
          (function(){
            const p = bySlot.accounting || {};
            const partner = p.partner_id ? partnersById[p.partner_id] : null;
            const name  = partner?.name || p.name  || document.getElementById('name-accounting').textContent;
            const title = partner ? (partner.category || 'Partner') : (p.title || document.getElementById('title-accounting').textContent);
            const logo  = partner?.logo_url || p.photo_url || '';
            showPhoto('photo-accounting', 'accounting', logo);
            setText('name-accounting', name);
            setText('title-accounting', title);
          })();

          // Sub-roller (vises altid – med placeholder hvis tomt)
          (function(){
            const rows = [
              { slot:'sub1', photo:'photo-sub-1', name:'name-sub-1', title:'title-sub-1' },
              { slot:'sub2', photo:'photo-sub-2', name:'name-sub-2', title:'title-sub-2' },
              { slot:'sub3', photo:'photo-sub-3', name:'name-sub-3', title:'title-sub-3' },
            ];
            rows.forEach(m => {
              const p = bySlot[m.slot] || {};
              const partner = p.partner_id ? partnersById[p.partner_id] : null;
              const name  = partner?.name || p.name  || document.getElementById(m.name).textContent;
              const title = partner ? (partner.category || 'Partner') : (p.title || document.getElementById(m.title).textContent);
              const logo  = partner?.logo_url || p.photo_url || '';
              showPhoto(m.photo, 'sub', logo);
              setText(m.name,  name);
              setText(m.title, title);
            });
          })();
        }catch(e){ console.warn('[about] org_people:', e); }
      } else {
        // Ingen Supabase? Brug kun fallbacks + eksisterende tekster i HTML
        showPhoto('photo-top', 'top', '');
        showPhoto('photo-mid', 'mid', '');
        showPhoto('photo-accounting', 'accounting', '');
        showPhoto('photo-sub-1', 'sub', '');
        showPhoto('photo-sub-2', 'sub', '');
        showPhoto('photo-sub-3', 'sub', '');
      }

      // ---------- Højre kolonne bokse ----------
      if (sb) {
        try{
          const { data } = await sb.from('about_boxes').select('title,content,sort').order('sort',{ascending:true});
          if (data?.length){
            const ids=['side-1','side-2','side-3'];
            data.slice(0,3).forEach((row,i)=>{
              const root=document.getElementById(ids[i]); if (!root) return;
              const h2=root.querySelector('h2'); const body=root.querySelector('.muted');
              if (row.title)   h2.innerHTML = row.title;
              if (row.content) body.innerHTML = row.content;
            });
          }
        }catch(e){ console.warn('[about] about_boxes:', e); }
      }

      // ---------- Social links ----------
      if (sb) {
        try{
          const root=document.getElementById('social-menu');
          if (root){
            const { data } = await sb.from('social_links')
              .select('name,url,icon,sort').order('sort',{ascending:true});
            const items=(data||[]).filter(x=>x?.url && String(x.url).trim().length>0);
            if (!items.length) root.style.display='none';
            else{
              root.innerHTML = items.map(x=>`
                <a href="${x.url}" target="_blank" rel="noopener" title="${x.name}">
                  <span class="sr-only">${x.name}</span>
                </a>`).join('');
            }
          }
        }catch(e){ console.warn('[about] social_links:', e); }
      }
    })();
  </script>
</body>
</html>
