<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Om MadaCoin</title>
  <link rel="preconnect" href="https://unpkg.com" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#061a2b;
      --bg-image:url('https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public/backgrounds/ocean.png');
      --text:#fff; --muted:#cfd3d7; --primary:#9ad4ff;
      --card:#0b0b0c; --card-border:#2a2a2a; --shadow:0 12px 26px rgba(0,0,0,.5); --radius:16px;
      --orange:#ff8a00;
      --wrap:1200px; --gap:24px; --left-col:520px; --right-col:420px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:var(--text);
      background: var(--bg) no-repeat center/cover fixed; background-image:var(--bg-image);
    }
    @media (max-width:900px){ body{ background-attachment:scroll } }

    a{ color:var(--primary); text-decoration:none }
    a:hover{ text-decoration:underline }

    .wrap{ max-width:var(--wrap); margin:0 auto; padding:18px 24px }
    header{ border-bottom:1px solid rgba(255,255,255,.06); background:transparent }
    /* Nav pills */
    nav{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
    nav a{
      color:#fff; padding:8px 14px; border-radius:12px;
      background:#0d0d0f; border:1px solid #333; text-decoration:none; opacity:.96;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    nav a:hover{ filter:brightness(1.08) }
    nav a.active{ border-color:#555; box-shadow: inset 0 1px 0 rgba(255,255,255,.12) }

    .social-menu{ display:flex; gap:12px; flex-wrap:wrap; margin-top:8px }
    .social-menu a{
      display:inline-flex;align-items:center;justify-content:center;
      width:36px;height:36px;border-radius:999px;background:#121214;border:1px solid #2a2a2a
    }
    .social-menu a:hover{ filter:brightness(1.1) }

    /* Layout */
    .layout{
      max-width:var(--wrap); margin:0 auto; padding:24px;
      display:grid; grid-template-columns:var(--left-col) 1fr var(--right-col); gap:var(--gap);
    }
    @media (max-width:1100px){ :root{ --left-col:460px; --right-col:360px } }
    @media (max-width:980px){ .layout{ grid-template-columns:1fr } }

    /* Cards/typografi */
    .card{ background:var(--card); border:1px solid var(--card-border); border-radius:var(--radius); box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.06) }
    .card.pad{ padding:18px }
    h1{ margin:10px 0 12px; font-size:clamp(22px,3.2vw,34px) }
    h2{ margin:0 0 10px; font-size:clamp(18px,2.2vw,22px) }
    .muted{ color:var(--muted) }
    .mb24{ margin-bottom:24px }

    /* Org venstre */
    .org-left{ position:relative }
    .person,.peer,.sub{ display:flex; flex-direction:column; align-items:center; gap:10px }
    .person{ margin-bottom:18px }

    /* Foto/logo-rammer – transparent når der ikke er billede */
    .photo{
      width:170px;height:170px;border-radius:8px;
      background:transparent; background-position:center; background-size:cover; background-repeat:no-repeat;
      border:1px solid #3a3a3a; box-shadow:0 6px 18px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
    }
    .photo.has-photo{ border-color:#2a2a2a; box-shadow:0 8px 22px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.04) }
    .sub .photo, .peer .photo{ width:120px; height:120px }

    .label{
      min-width:220px;text-align:center;padding:8px 14px;border-radius:999px;
      background:#0d0d0f;border:1px solid #333;box-shadow:inset 0 1px 0 rgba(255,255,255,.06);line-height:1.2
    }
    .label .title{ opacity:.9; font-size:13px }

    /* Lodret links */
    .vlink{ width:6px;height:38px;background:var(--orange);border-radius:3px;margin:6px auto 16px }
    .vlink.long{ height:58px }

    /* Midterlinje (to peers: accounting + Thomas) */
    .midline{ position:relative; padding-top:26px; display:flex; gap:36px; justify-content:space-between }
    .midline .hbar{ position:absolute; top:0; left:10%; right:10%; height:6px; background:var(--orange); border-radius:3px }
    .midline .connector{ width:6px; height:26px; background:var(--orange); border-radius:3px; margin-bottom:4px }
    .midline.single{ justify-content:center }
    .midline.single .hbar, .midline.single .connector{ display:none }

    /* Bundgren (3 sub-roller) */
    .branch{ position:relative; padding-top:26px; display:flex; gap:36px; justify-content:space-between }
    .branch .hbar{ position:absolute; top:0; left:6%; right:6%; height:6px; background:var(--orange); border-radius:3px }
    .branch .sub::before{ content:""; width:6px;height:26px;background:var(--orange);border-radius:3px;margin-bottom:4px }
    .branch.single .hbar, .branch.single .sub::before{ display:none }

    /* Kolonner */
    .info-col{ display:flex; flex-direction:column; gap:24px }
    .info-card{ min-height:170px }
    .side-col{ display:flex; flex-direction:column; gap:24px }
    .side-card{ min-height:180px }

    /* Footer */
    .site-footer{
      margin-top:28px;border-top:1px solid rgba(255,255,255,.06);background:#000;color:#fff;text-align:center;padding:20px
    }
    .site-footer a{ color:#fff; text-decoration:underline }
  </style>
</head>
<body>
  <header class="wrap">
    <nav>
      <a href="/index.html" data-text="common:nav_home">Home</a>
      <a href="/madacoin.html" class="active" data-text="common:nav_about">Om</a>
      <a href="/rapporter.html" data-text="common:nav_reports">Rapporter</a>
    </nav>
    <div class="social-menu" id="social-menu"></div>
  </header>

  <div class="layout">
    <!-- Venstre: Org -->
    <section class="org-left">
      <!-- Top (Julienne) -->
      <div class="person" id="person-top">
        <div class="photo" id="photo-top" aria-label="Profilbillede"></div>
        <div class="label">
          <div class="name" id="name-top">Julienne</div>
          <div class="title" id="title-top">Ejer og Direktør</div>
        </div>
      </div>

      <div class="vlink" id="vlink-top-mid"></div>

      <!-- Midterlinje: Accounting (venstre) + Thomas (højre) -->
      <div class="midline" id="midline">
        <div class="hbar" id="mid-hbar"></div>

        <div class="peer" id="peer-accounting">
          <div class="connector"></div>
          <div class="photo" id="photo-accounting"></div>
          <div class="label">
            <div class="name" id="name-accounting">Revision &amp; Regnskab</div>
            <div class="title" id="title-accounting">Partner</div>
          </div>
        </div>

        <div class="peer" id="peer-mid">
          <div class="connector"></div>
          <div class="photo" id="photo-mid"></div>
          <div class="label">
            <div class="name" id="name-mid">Thomas</div>
            <div class="title" id="title-mid">Adm. Direktør · Udvikler</div>
          </div>
        </div>
      </div>

      <div class="vlink long" id="vlink-mid-branch"></div>

      <!-- Bund: tre underliggende (fx Arkitekt, Byggefirma, …) -->
      <div class="branch" id="branch">
        <div class="hbar" id="hbar"></div>

        <div class="sub" id="sub-1">
          <div class="photo" id="photo-sub-1"></div>
          <div class="label">
            <div class="name" id="name-sub-1">Navn</div>
            <div class="title" id="title-sub-1">Rolle</div>
          </div>
        </div>

        <div class="sub" id="sub-2">
          <div class="photo" id="photo-sub-2"></div>
          <div class="label">
            <div class="name" id="name-sub-2">Navn</div>
            <div class="title" id="title-sub-2">Rolle</div>
          </div>
        </div>

        <div class="sub" id="sub-3">
          <div class="photo" id="photo-sub-3"></div>
          <div class="label">
            <div class="name" id="name-sub-3">Navn</div>
            <div class="title" id="title-sub-3">Rolle</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Midt: Julienne bio + Regnskab info -->
    <section class="info-col">
      <article class="card pad info-card" id="bio-top">
        <h2 data-text="about:bio_top_title">Direktør · profil</h2>
        <p class="muted" data-text="about:bio_top">…</p>
      </article>

      <article class="card pad info-card" id="bio-accounting">
        <h2 data-text="about:accounting_title">Revision &amp; Åbenhed</h2>
        <p class="muted" data-text="about:accounting_blurb">…</p>
      </article>
    </section>

    <!-- Højre: Om Thomas + tre bokse -->
    <aside class="side-col">
      <article class="card pad side-card" id="bio-thomas">
        <h2 data-text="about:thomas_bio_title">Om Thomas</h2>
        <div class="muted" data-text="about:thomas_bio">…</div>
      </article>

      <div class="card pad side-card" id="side-1">
        <h2 data-text="about:right_1_title">Vores version</h2>
        <div class="muted" data-text="about:right_1">…</div>
      </div>
      <div class="card pad side-card" id="side-2">
        <h2 data-text="about:right_2_title">opdelt</h2>
        <div class="muted" data-text="about:right_2">…</div>
      </div>
      <div class="card pad side-card" id="side-3">
        <h2 data-text="about:right_3_title">flere gange</h2>
        <div class="muted" data-text="about:right_3">…</div>
      </div>
    </aside>
  </div>

  <footer class="site-footer">
    <span data-text="common:footer">© 2025 MadaCoin. All rights reserved.</span>
  </footer>

  <script>
    // Init Supabase client
    (function(){
      if (!window.supabase?.createClient) { console.warn('[about] Supabase lib mangler'); return; }
      if (!window.SUPABASE_URL || !window.SUPABASE_ANON) { console.warn('[about] SUPABASE_URL/ANON mangler'); return; }
      window.sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON);
    })();

    (async () => {
      const sb = window.sb; if (!sb) return;

      // SETTINGS (titel, favicons, tema)
      try{
        const { data } = await sb.from('settings')
          .select('site_title,favicon_svg_url,favicon_png_url,apple_touch_icon_url,theme_primary,bg_image_url,bg_color')
          .eq('id',1).single();
        if (data){
          if (data.site_title) document.title = data.site_title;
          const ensure=(id,rel,extra={})=>{let el=document.getElementById(id); if(!el){el=document.createElement('link'); el.id=id; el.rel=rel; document.head.appendChild(el)} Object.assign(el,extra) };
          if (data.favicon_svg_url) ensure('fav-svg','icon',{type:'image/svg+xml',href:data.favicon_svg_url});
          if (data.favicon_png_url) ensure('fav-png','icon',{href:data.favicon_png_url,sizes:'any'});
          if (data.apple_touch_icon_url) ensure('apple-icon','apple-touch-icon',{href:data.apple_touch_icon_url});
          const root=document.documentElement;
          if (data.theme_primary) root.style.setProperty('--primary', data.theme_primary);
          if (data.bg_color) root.style.setProperty('--bg', data.bg_color);
          if (data.bg_image_url) root.style.setProperty('--bg-image', `url('${data.bg_image_url}')`);
        }
      }catch(e){ console.warn('[about] settings:', e); }

      // SITE TEXT (common + about)
      try{
        const { data } = await sb.from('site_text').select('page,key,value').in('page',['common','about']);
        if (data){
          const dict=Object.fromEntries(data.map(r=>[`${r.page}:${r.key}`,r.value]));
          document.querySelectorAll('[data-text]').forEach(el=>{ const k=el.getAttribute('data-text'); if (dict[k]) el.innerHTML = dict[k]; });
        }
      }catch(e){ console.warn('[about] site_text:', e); }

      // ORG PEOPLE (+optional partners via partner_id)
      let partnersById = {};
      try{
        const { data: people } = await sb.from('org_people')
          .select('slot,name,title,photo_url,bio,partner_id')
          .in('slot',['top','mid','accounting','sub1','sub2','sub3']);

        // Hvis der er partner_id'er → hent dem
        const partnerIds = [...new Set((people||[]).map(p=>p.partner_id).filter(Boolean))];
        if (partnerIds.length){
          const { data: partners } = await sb.from('partners')
            .select('id,name,website,logo_url,logo_alt,category,active')
            .in('id', partnerIds);
          partnersById = Object.fromEntries((partners||[]).map(x=>[x.id,x]));
        }

        const bySlot = Object.fromEntries((people||[]).map(x=>[x.slot,x]));
        const exists = slot => {
          const p = bySlot[slot]; if (!p) return false;
          const hasPartner = p.partner_id && partnersById[p.partner_id];
          const hasAny = ['name','title','photo_url','bio'].some(k => p[k] && String(p[k]).trim());
          return hasPartner || hasAny;
        };
        const showPhoto = (elId, url) => {
          const el = document.getElementById(elId);
          if (!el) return;
          if (url){ el.style.backgroundImage = `url('${url}')`; el.classList.add('has-photo'); }
        };
        const setText = (id, val) => { const el=document.getElementById(id); if (el && val) el.textContent = val; };
        const hide = sel => document.querySelectorAll(sel).forEach(el => el && (el.style.display='none'));

        // TOP (Julienne)
        (function(){
          const p = bySlot.top;
          if (!p){ hide('#person-top','#vlink-top-mid'); return; }
          showPhoto('photo-top', p.photo_url);
          setText('name-top', p.name);
          setText('title-top', p.title);
          if (p.bio){ const el = document.querySelector('#bio-top [data-text="about:bio_top"]'); if (el) el.innerHTML = p.bio; }
        })();

        // MIDLINE peers: ACCOUNTING + THOMAS (mid)
        (function(){
          // Accounting
          (function(){
            const p = bySlot.accounting;
            if (!p){ hide('#peer-accounting'); }
            else {
              const partner = p.partner_id ? partnersById[p.partner_id] : null;
              const name = partner?.name || p.name;
              const title = partner ? (partner.category || 'Partner') : p.title;
              const logo = partner?.logo_url || p.photo_url;

              showPhoto('photo-accounting', logo);
              setText('name-accounting', name);
              setText('title-accounting', title || 'Partner');
              // Tekstkort i midterkolonnen styres via site_text (about:accounting_*), men kunne suppleres her hvis ønsket
            }
          })();

          // Thomas (mid)
          (function(){
            const p = bySlot.mid;
            if (!p){ hide('#peer-mid'); }
            else {
              showPhoto('photo-mid', p.photo_url);
              setText('name-mid', p.name);
              setText('title-mid', p.title);
              // Thomas bio flyttes til højre kolonne
              if (p.bio){ const el = document.querySelector('#bio-thomas [data-text="about:thomas_bio"]'); if (el) el.innerHTML = p.bio; }
            }
          })();

          // Justér midline/hbar/links
          const midline = document.getElementById('midline');
          const peers = ['#peer-accounting','#peer-mid'].map(s=>document.querySelector(s)).filter(el=>el && getComputedStyle(el).display!=='none');
          if (peers.length === 0){
            hide('#midline'); hide('#vlink-top-mid');
          } else if (peers.length === 1){
            midline.classList.add('single');
          }
        })();

        // Bund: sub1–sub3 (fx arkitekt, byggefirma, m.m.)
        (function(){
          const fills = [
            ['sub1','photo-sub-1','name-sub-1','title-sub-1'],
            ['sub2','photo-sub-2','name-sub-2','title-sub-2'],
            ['sub3','photo-sub-3','name-sub-3','title-sub-3'],
          ];
          fills.forEach(([slot, phId, nmId, ttId])=>{
            const p = bySlot[slot];
            if (!p){ hide(`#${nmId.replace('name','sub')}`); return; }
            const partner = p.partner_id ? partnersById[p.partner_id] : null;
            const name = partner?.name || p.name;
            const title = partner ? (partner.category || 'Partner') : p.title;
            const logo = partner?.logo_url || p.photo_url;

            showPhoto(phId, logo);
            setText(nmId, name);
            setText(ttId, title || '');
          });

          // Visibilitet/forbindelser for branch
          const branch = document.getElementById('branch');
          const visibleSubs = [...branch.querySelectorAll('.sub')].filter(el => getComputedStyle(el).display!=='none');
          if (visibleSubs.length === 0){
            hide('#branch'); hide('#vlink-mid-branch');
          } else if (visibleSubs.length <= 1){
            branch.classList.add('single');
          }
        })();

      }catch(e){ console.warn('[about] org_people:', e); }

      // Højre kolonne: about_boxes
      try{
        const { data } = await sb.from('about_boxes').select('title,content,sort').order('sort',{ascending:true});
        if (data?.length){
          const ids=['side-1','side-2','side-3'];
          data.slice(0,3).forEach((row,i)=>{
            const root=document.getElementById(ids[i]); if (!root) return;
            const h2=root.querySelector('h2'); const body=root.querySelector('.muted');
            if (row.title) h2.innerHTML=row.title;
            if (row.content) body.innerHTML=row.content;
          });
        }
      }catch(e){ console.warn('[about] about_boxes:', e); }

      // Social links
      try{
        const root=document.getElementById('social-menu');
        if (root){
          const { data } = await sb.from('social_links').select('name,url,icon,sort').order('sort',{ascending:true});
          const items=(data||[]).filter(x=>x?.url && String(x.url).trim().length>0);
          if (!items.length) root.style.display='none';
          else{
            root.innerHTML = items.map(x=>`
              <a href="${x.url}" target="_blank" rel="noopener" title="${x.name}">
                <span class="sr-only">${x.name}</span>
              </a>`).join('');
          }
        }
      }catch(e){ console.warn('[about] social_links:', e); }
    })();
  </script>
</body>
</html>
