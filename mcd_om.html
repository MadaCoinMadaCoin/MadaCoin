<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Om MadaCoin</title>
  <link rel="preconnect" href="https://unpkg.com" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    :root{
      /* Desktop-lærred og kolonner */
      --wrap: 1680px;
      --gap: 84px;
      --left-col: 520px;
      --center-col: 460px;
      --right-col: 720px;

      /* Afstande */
      --edge-pad: 24px;
      --right-gutter: 48px;
      --center-offset: -36px;

      /* Foto-størrelser (desktop) */
      --photo-top: 144px;
      --photo-peer: 108px;
      --photo-sub: 102px;

      /* Social menu */
      --social-top: 104px;

      /* Farver/stil */
      --bg:#061a2b;
      --bg-image:url('https://byrlebjwknppjbtbkozt.supabase.co/storage/v1/object/public/backgrounds/ocean.png');
      --text:#fff; --muted:#cfd3d7; --primary:#9ad4ff;
      --card:#0b0b0c; --card-border:#2a2a2a; --shadow:0 12px 26px rgba(0,0,0,.5); --radius:16px;

      /* Nav */
      --nav-gap:14px; --nav-pad-x:14px; --nav-pad-y:8px;
      --nav-text:#fff; --nav-bg:#0d0d0f; --nav-border:#333;
      --nav-hover-bg:#151517; --nav-hover-border:#444; --nav-active:#5aa9ff;

      /* Baggrund (overskrives fra DB) */
      --bg-1x: var(--bg-image);
      --bg-2x: var(--bg-image);
    }

    *{box-sizing:border-box}
    html{ font-size:16px; }
    body{
      margin:0; min-height:100vh; display:flex; flex-direction:column;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:var(--text);

      /* Lagdelt baggrund: let overlay + foto (1x/2x) + farvefallback */
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.14)),
        image-set(var(--bg-1x) 1x, var(--bg-2x) 2x),
        var(--bg);
      background-repeat:no-repeat,no-repeat,no-repeat;
      background-size:auto,cover,auto;
      background-attachment:fixed,fixed,fixed;
      background-position:center center, center top, center center;

      overflow-x:hidden;
    }
    @media (max-width:900px){ body{ background-attachment:scroll,scroll,scroll } }

    /* NAV */
    .site-nav{
      position: sticky; top: 0; z-index: 9999;
      padding: 24px 0;
      background: transparent !important; border:0 !important; box-shadow:none !important;
    }
    .site-nav::before,.site-nav::after{ display:none !important; content:none !important; }
    .nav-inner{ padding-left:var(--edge-pad); padding-right:var(--edge-pad); }
    .site-nav nav{
      display:flex; gap:var(--nav-gap); align-items:center; flex-wrap:wrap;
      justify-content:flex-start; transform:translateY(-2px);
    }
    .site-nav nav a{
      display:inline-flex; align-items:center; justify-content:center;
      padding:var(--nav-pad-y) var(--nav-pad-x);
      color:var(--nav-text); background:var(--nav-bg); border:1px solid var(--nav-border);
      border-radius:12px; text-decoration:none; opacity:.96; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      -webkit-tap-highlight-color:rgba(255,255,255,.15);
      font-size:1rem;
    }
    .site-nav nav a:hover{ background:var(--nav-hover-bg); border-color:var(--nav-hover-border); }
    .site-nav nav a.active{
      border-color:var(--nav-active);
      box-shadow:0 0 0 2px color-mix(in srgb, var(--nav-active) 25%, transparent) inset;
    }

    /* Social menu */
    .social-menu{
      position:fixed; top:var(--social-top); left:var(--edge-pad);
      display:flex; flex-direction:column; gap:10px; z-index:1000;
    }
    .social-menu a{
      display:flex; align-items:center; justify-content:center;
      width:42px; height:42px; background:rgba(0,0,0,.7); border-radius:8px;
      text-decoration:none; transition:background-color .2s, transform .15s;
    }
    .social-menu a:hover{ background:rgba(0,0,0,.85); transform:translateY(-2px); }
    .social-menu a img{ width:22px; height:22px; }

    /* Mobil HERO (kun mobil) */
    .m-hero{ display:none; }
    .m-hero .box{
      background:#0b0b0c; border:1px solid #2a2a2a; border-radius:16px;
      box-shadow:0 12px 26px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.06);
      padding:16px 18px; margin:8px auto 10px; width:calc(100vw - 32px);
    }
    .m-hero .ribbon{
      display:inline-block; margin:-2px 0 8px; padding:4px 10px; border-radius:999px; font-size:12px;
      background:#102414; border:1px solid #1d3d22; color:#baf7c9; box-shadow:inset 0 1px 0 rgba(255,255,255,.06)
    }
    .m-hero h1{ font-size:clamp(18px,6.2vw,22px); margin:.1rem 0 .4rem }
    .m-hero p{ color:#cfd3d7; margin:.25rem 0 .6rem; font-size:.95rem }
    .m-hero .btns{ display:flex; gap:10px; flex-wrap:wrap }
    .m-hero .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:8px 12px; border-radius:12px; text-decoration:none; cursor:pointer;
      background:#0d0d0f; border:1px solid #333; color:#fff; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
    }
    .m-hero .btn.primary{ background:linear-gradient(135deg,#FFD700,#DAA520); color:#1c2630; border-color:#865c10 }

    /* Indhold – desktop grid */
    .layout{
      max-width:var(--wrap); margin:0 auto;
      padding:24px var(--edge-pad);
      display:grid;
      grid-template-columns: var(--left-col) var(--center-col) var(--right-col);
      grid-template-rows: auto auto auto;
      gap:var(--gap);
      align-items:start;
      flex:1;
      position:relative; z-index:0;
    }

    /* Kort */
    .card{
      background:var(--card); border:1px solid var(--card-border); border-radius:var(--radius);
      box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.06)
    }
    .card.pad{ padding:18px }
    h1{ font-size:clamp(22px,2.6vw,26px); line-height:1.25; margin:0 0 .5em; }
    h2{ margin:0 0 10px; font-size:clamp(18px,2.2vw,22px) }
    .muted{ color:var(--muted) }

    /* Venstre bio-kolonne */
    .bio-card{ width:360px; min-height:190px; max-width:100% }
    #bio-top{ grid-column:1; grid-row:1; }
    #bio-thomas{ grid-column:1; grid-row:2; }

    /* Midterkolonnen (pyramiden) */
    .center-col{
      grid-column:2; display:flex; flex-direction:column; align-items:center; gap:32px;
      transform: translateX(var(--center-offset));
    }
    #pyr-top{ grid-row:1; }
    #pyr-mid{ grid-row:2; }
    #pyr-sub{ grid-row:3; }

    .people-mid{ display:flex; gap:36px; align-items:flex-start; justify-content:center }

    .person,.peer,.sub{ display:flex; flex-direction:column; align-items:center; gap:10px }

    /* Fotos */
    .photo-top{
      width:var(--photo-top); height:var(--photo-top);
      border-radius:8px; background-position:50% 50%; background-size:cover; background-repeat:no-repeat;
      border:1px solid transparent;
      cursor:default; /* ser ikke klikbar ud */
    }
    .photo-peer, .photo-sub{
      border-radius:8px; background-position:50% 50%; background-size:cover; background-repeat:no-repeat;
      border:1px solid transparent;
    }
    .photo-peer{ width:var(--photo-peer); height:var(--photo-peer); }
    .photo-sub{ width:var(--photo-sub); height:var(--photo-sub); }
    .has-photo{ border-color:#2a2a2a; box-shadow:0 8px 22px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.04) }
    .portrait{ background-position:50% 35% }

    /* Labels */
    .label{
      min-width:192px; max-width:220px;
      text-align:center; padding:8px 14px; border-radius:999px;
      background:#0d0d0f; border:1px solid #333; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      line-height:1.2
    }
    .label .name, .label .title{ overflow-wrap:anywhere; white-space:normal }
    .label .title{ opacity:.9; font-size:13px }

    /* Underroller række */
    .sub-row{ display:flex; justify-content:center; gap:36px; }

    /* Højre kolonne – “Vores version” */
    .right-col{
      grid-column:3; grid-row:1 / span 3;
      margin-top:36px;
      margin-left:8px;
      padding-right: var(--right-gutter);
      position: relative; z-index: 0;
    }
    .right-col .card{ width:100% }
    .right-col #right-main .muted{ min-height: 8rem; }

    /* Partner-stribe */
    .partners{ margin: 8px auto 0; padding: 18px 0 8px; }
    .partners-title{
      margin: 0 0 10px;
      font-size: clamp(16px, 1.8vw, 18px);
      color: #cfd3d7; opacity: .95;
    }
    .partners-list{
      display:flex; flex-wrap:wrap; gap:18px; align-items:center;
      border-top:1px solid rgba(255,255,255,.06);
      padding-top:14px;
    }
    .partner{
      display:inline-flex; align-items:center; justify-content:center;
      width:120px; height:54px; padding:8px 10px;
      background:#0d0d0f; border:1px solid #2a2a2a; border-radius:12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
      transition: transform .15s ease, filter .15s ease, background .15s ease;
    }
    .partner:hover{ transform: translateY(-1px); filter: brightness(1.08); }
    .partner img{ max-width:100%; max-height:100%; display:block; object-fit:contain; filter: saturate(.9) contrast(1.05); }

    /* Footer */
    .site-footer{
      margin-top:auto; padding:12px 16px; color:#fff; text-align:center;
      background:rgba(0,0,0,.75); border-top:1px solid rgba(255,255,255,.06);
    }

    /* LOGIN MODAL */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal.active{display:flex}
    .sheet{width:min(420px,92vw);background:#0f1423;border:1px solid #2a3a55;border-radius:16px;padding:18px}
    .row{display:flex;gap:10px;align-items:center}
    label{display:block;margin:6px 0;color:#cfe3ff}
    input[type="email"],input[type="password"]{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3f5e;background:#0b1221;color:#fff}
    .btn{cursor:pointer;border-radius:10px;border:1px solid #2f4a6a;background:#0f1a2b;color:#fff;padding:10px 12px}
    .btn.primary{background:linear-gradient(135deg,#8bd5ff,#66c2ff);color:#0b2236;border-color:#27608a;font-weight:700}
    .x{border:none;background:transparent;color:#9ccfff;font-size:22px;line-height:1;cursor:pointer}
    .small{font-size:13px;color:#a9b4c8}

    /* MOBIL */
    @media (max-width: 900px){
      body{ font-size: .95rem; }
      h1{ font-size: clamp(18px, 6.2vw, 22px); }
      h2{ font-size: clamp(16px, 5.2vw, 20px); }
      :root{ --social-top: 116px; }
      .m-hero{ display:block; }
      .m-hero .box{ padding-left: calc(16px + 76px); }

      .layout{
        grid-template-columns: 1fr;
        grid-auto-flow: row; grid-auto-rows: auto;
        gap: 18px;
        padding: 12px 16px 24px;
        padding-left: calc(16px + 76px);
      }
      .layout > *{
        grid-column: 1 !important;
        grid-row: auto !important;
        min-width: 0;
      }
      .center-col{ transform:none; }
      .people-mid{ flex-direction:column; align-items:center; gap:14px; width:100%; }
      .peer{ width:100%; }
      .label{ max-width: 92vw; }
      .right-col{ margin: 0; padding: 0; }
      .right-col .card{ width:100%; margin:0; box-sizing:border-box; }
      .site-nav{ padding: 16px 0; }
      .nav-inner{ padding-left:16px; padding-right:24px; }
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="site-nav">
    <div class="nav-inner">
      <nav>
        <a href="/index.html" data-text="common:nav_home">Home</a>
        <a href="/madacoin.html" class="active" data-text="common:nav_about">Om</a>
        <a href="/roadmap.html" data-text="common:nav_roadmap">Roadmap</a>
        <a href="/rapporter.html" data-text="common:nav_reports">Rapporter</a>
      </nav>
    </div>
  </header>

  <!-- VENSTRE: Sociale links -->
  <div class="social-menu" id="social-menu"></div>

  <!-- MOBIL HERO (kun mobil) -->
  <section class="m-hero" aria-hidden="true">
    <div class="box">
      <div class="ribbon" data-text="about:hero_ribbon">NYHED: 25% hotelrabat</div>
      <h1 data-text="about:hero_title">Om MadaCoin</h1>
      <p data-text="about:hero_sub">Donationer til skoler, solenergi og lokale jobs — med fuld gennemsigtighed.</p>
      <div class="btns">
        <a class="btn primary" href="/index.html" data-text="about:hero_cta_primary">Støt med MadaCoin</a>
        <a class="btn" href="/rapporter.html" data-text="about:hero_cta_secondary">Se rapporter</a>
      </div>
    </div>
  </section>

  <!-- TRE-KOLONNE LAYOUT -->
  <div class="layout">
    <!-- Venstre bio-kolonne -->
    <article class="card pad bio-card" id="bio-top">
      <h2 data-text="about:bio_top_title">Direktør · profil</h2>
      <div class="muted" data-text="about:bio_top">
        CM Manager for InnoGames for 10 years with up to 4 workers directly under me.
      </div>
    </article>

    <article class="card pad bio-card" id="bio-thomas">
      <h2 data-text="about:thomas_bio_title">Om Thomas</h2>
      <div class="muted" data-text="about:thomas_bio">
        CM Manager for InnoGames for 10 years with up to 4 workers directly under me.
      </div>
    </article>

    <!-- Midterkolonnen: pyramiden -->
    <section class="center-col" id="pyr-top">
      <div class="person">
        <div class="photo-top" id="photo-top" aria-label="Julienne" tabindex="0"></div>
        <div class="label">
          <div class="name" id="name-top">Julienne</div>
          <div class="title" id="title-top">Ejer og Direktør</div>
        </div>
      </div>
    </section>

    <section class="center-col" id="pyr-mid">
      <div class="people-mid">
        <div class="peer">
          <div class="photo-peer" id="photo-mid"></div>
          <div class="label">
            <div class="name" id="name-mid">Thomas</div>
            <div class="title" id="title-mid">Adm. Direktør · Udvikler</div>
          </div>
        </div>
        <div class="peer">
          <div class="photo-peer" id="photo-accounting"></div>
          <div class="label">
            <div class="name" id="name-accounting">Revision &amp; Regnskab</div>
            <div class="title" id="title-accounting">Partner</div>
          </div>
        </div>
      </div>
    </section>

    <section class="center-col" id="pyr-sub">
      <div class="sub-row">
        <div class="sub">
          <div class="photo-sub" id="photo-sub-1"></div>
          <div class="label">
            <div class="name" id="name-sub-1">Navn</div>
            <div class="title" id="title-sub-1">Rolle</div>
          </div>
        </div>
        <div class="sub">
          <div class="photo-sub" id="photo-sub-2"></div>
          <div class="label">
            <div class="name" id="name-sub-2">Navn</div>
            <div class="title" id="title-sub-2">Rolle</div>
          </div>
        </div>
        <div class="sub">
          <div class="photo-sub" id="photo-sub-3"></div>
          <div class="label">
            <div class="name" id="name-sub-3">Navn</div>
            <div class="title" id="title-sub-3">Rolle</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Højre kolonne: stor permanent tekst -->
    <aside class="right-col">
      <div class="card pad" id="right-main">
        <h2 data-text="about:right_title">Vores version</h2>
        <div class="muted" data-text="about:right_body">
          <!-- Indhold hentes fra Supabase (about:right_body) -->
        </div>
      </div>
    </aside>
  </div>

  <!-- GULVPLADS: Samarbejdspartnere -->
  <section class="partners wrap" id="partners">
    <h3 class="partners-title">Samarbejdspartnere</h3>
    <div class="partners-list" id="partners-list" aria-label="Samarbejdspartnere"></div>
  </section>

  <footer class="site-footer">
    <span data-text="common:footer">© 2025 MadaCoin. All rights reserved.</span>
  </footer>

  <!-- LOGIN MODAL -->
  <div class="modal" id="admin-modal" aria-hidden="true">
    <div class="sheet">
      <div class="row" style="justify-content:space-between">
        <h3 style="margin:0">Admin login</h3>
        <button class="x" id="mdl-close" aria-label="Luk">×</button>
      </div>
      <p class="small">Kun for godkendte administratorer.</p>
      <label>Email
        <input id="adm-email" type="email" placeholder="you@madacoin.pro" />
      </label>
      <label>Kodeord
        <input id="adm-pass" type="password" placeholder="••••••••" />
      </label>
      <div class="row" style="margin-top:10px;justify-content:flex-end">
        <button class="btn" id="mdl-cancel">Annullér</button>
        <button class="btn primary" id="mdl-login">Log ind</button>
      </div>
      <div id="adm-msg" class="small" style="margin-top:8px;color:#ff9aa3"></div>
    </div>
  </div>

  <script>
    /* Supabase client */
    const SUPABASE_URL = window.SUPABASE_URL || "https://byrlebjwknppjbtbkozt.supabase.co";
    const SUPABASE_ANON = window.SUPABASE_ANON || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5cmxlYmp3a25wcGpidGJrb3p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjcyNjYsImV4cCI6MjA2NzM0MzI2Nn0.3aoQMQgmxXouUfpqrwfSgcUgedjZEue6s3ZkGoqvQYY";
    const sb = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON) : null;
    window.sb = sb;

    /* site_text → udfyld tekster (common + about) */
    (async function(){
      if(!sb) return;
      try{
        const { data } = await sb.from('site_text').select('page,key,value').in('page',['common','about']);
        const dict = {}; (data||[]).forEach(r=>dict[`${r.page}:${r.key}`]=r.value);
        document.querySelectorAll('[data-text]').forEach(el=>{
          const k=el.getAttribute('data-text'); if(dict[k]!=null) el.innerHTML=dict[k];
        });
      }catch(e){ console.warn('[about] site_text', e); }
    })();

    /* Baggrund pr. side (“om”) – læs fra site_settings */
    async function applyBackgroundForPage(pageKey){
      if(!sb) return;
      try{
        const keys=[`bg_${pageKey}_1x`,`bg_${pageKey}_2x`,`bg_default_1x`,`bg_default_2x`];
        const { data } = await sb.from('site_settings').select('key,value').in('key', keys);
        const map = Object.fromEntries((data||[]).map(r=>[r.key,r.value]));
        const one = map[`bg_${pageKey}_1x`] || map['bg_default_1x'] || '';
        const two = map[`bg_${pageKey}_2x`] || map['bg_default_2x'] || '';
        if(one) document.body.style.setProperty('--bg-1x', `url("${one}")`);
        if(two) document.body.style.setProperty('--bg-2x', `url("${two}")`);
      }catch(e){ console.warn('[about] background', e); }
    }
    applyBackgroundForPage('om');

    /* Sociale links */
    function normalizeUrl(u){ if(!u) return null; const t=u.trim(); return /^https?:\/\//i.test(t)?t:'https://'+t }
    function iconUrlFor(platform){
      if(!sb) return null;
      const name = platform.charAt(0).toUpperCase()+platform.slice(1).toLowerCase();
      const { data } = sb.storage.from('social.icons').getPublicUrl(`${name}.svg`);
      return data?.publicUrl || null;
    }
    function fallbackIconUrl(){
      if(!sb) return '';
      const { data } = sb.storage.from('social.icons').getPublicUrl('Globe.svg');
      return data?.publicUrl || '';
    }
    async function renderSocialLinks(){
      const el = document.getElementById('social-menu'); if(!el || !sb) return;
      el.innerHTML = '';
      const { data, error } = await sb
        .from('social_links')
        .select('platform,url,is_active,sort_order')
        .eq('is_active', true)
        .order('sort_order', { ascending: true });
      if(error){ console.warn('social_links', error); return; }
      const globe = fallbackIconUrl();
      (data||[]).filter(r=>r.url && r.url.trim()!=='').forEach(r=>{
        const a=document.createElement('a');
        const href=normalizeUrl(r.url); if(!href) return;
        a.href=href; a.target='_blank'; a.rel='noopener noreferrer';
        a.title=r.platform; a.setAttribute('aria-label', r.platform);
        const img=document.createElement('img');
        img.src=iconUrlFor(r.platform)||globe; img.onerror=()=>{ img.src=globe; };
        a.appendChild(img);
        el.appendChild(a);
      });
    }
    window.addEventListener('load', renderSocialLinks);

    /* Personer/partnere */
    (async function(){
      if(!sb) return;
      try{
        const pplRes = await sb.from('org_people')
          .select('slot,name,title,photo_url,bio,partner_id')
          .in('slot',['top','mid','accounting','sub1','sub2','sub3']);
        const ppl = pplRes.data||[];

        const ids=[]; const partnersById={};
        ppl.forEach(p=>{ if(p.partner_id) ids.push(p.partner_id); });
        if(ids.length){
          const prRes=await sb.from('partners')
            .select('id,name,website,logo_url,logo_alt,category,active')
            .in('id',ids);
          (prRes.data||[]).forEach(x=>partnersById[x.id]=x);
        }

        const bySlot={}; ppl.forEach(x=>bySlot[x.slot]=x);
        const STORAGE_BASE = SUPABASE_URL.replace(/\/+$/,'') + '/storage/v1/object/public';
        const PLACEHOLDER='data:image/svg+xml;utf8,%3Csvg xmlns%3D%22http%3A//www.w3.org/2000/svg%22 viewBox%3D%220 0 256 256%22%3E%3Ccircle cx%3D%22128%22 cy%3D%22128%22 r%3D%22118%22 fill%3D%22%23f7c14b%22 stroke%3D%22%236b4a0e%22 stroke-width%3D%226%22/%3E%3Ctext x%3D%2250%25%22 y%3D%2255%25%22 text-anchor%3D%22middle%22 font-family%3D%22Segoe%20UI%2CArial%22 font-size%3D%2288%22 font-weight%3D%22700%22 fill%3D%22%232b1b05%22%3EMC%3C/text%3E%3C/svg%3E';
        function fb(slot){
          if(slot==='top') return STORAGE_BASE+'/people/Owner.jpg';
          if(slot==='mid') return STORAGE_BASE+'/people/ADM.jpg';
          if(slot==='accounting') return STORAGE_BASE+'/people/Revision.jpg';
          return '';
        }
        function showPhoto(id,slot,url){
          const el=document.getElementById(id); if(!el) return;
          const fallback=fb(slot);
          const has=!!(url && String(url).trim());
          const chosen=has?url:(fallback||PLACEHOLDER);
          el.style.backgroundImage=`url('${chosen}')`;
          const img=new Image(); img.onload=()=>{ if(img.naturalHeight>img.naturalWidth*1.15) el.classList.add('portrait'); else el.classList.remove('portrait'); }; img.src=chosen;
          let addFrame=has; if(!has && slot==='accounting' && fallback) addFrame=false; if(!has && !fallback) addFrame=false;
          el.classList.toggle('has-photo', addFrame);
        }
        function setText(id,val){ const el=document.getElementById(id); if(el && val!=null) el.textContent=val; }

        /* top */
        { const p=bySlot.top||{};
          showPhoto('photo-top','top',p.photo_url);
          setText('name-top',p.name||document.getElementById('name-top').textContent);
          setText('title-top',p.title||document.getElementById('title-top').textContent);
          if(p.bio){ const el=document.querySelector('#bio-top [data-text="about:bio_top"]'); if(el) el.innerHTML=p.bio; }
        }
        /* mid */
        { const p=bySlot.mid||{};
          showPhoto('photo-mid','mid',p.photo_url);
          setText('name-mid',p.name||document.getElementById('name-mid').textContent);
          setText('title-mid',p.title||document.getElementById('title-mid').textContent);
          if(p.bio){ const el=document.querySelector('#bio-thomas [data-text="about:thomas_bio"]'); if(el) el.innerHTML=p.bio; }
        }
        /* accounting */
        { const p=bySlot.accounting||{};
          const partner=p.partner_id?partnersById[p.partner_id]:null;
          const name=(partner&&partner.name)||p.name||document.getElementById('name-accounting').textContent;
          const title=partner?(partner.category||'Partner'):(p.title||document.getElementById('title-accounting').textContent);
          const logo=(partner&&partner.logo_url)||p.photo_url||'';
          showPhoto('photo-accounting','accounting',logo);
          setText('name-accounting',name); setText('title-accounting',title);
        }
        /* subs */
        [{slot:'sub1',photo:'photo-sub-1',name:'name-sub-1',title:'title-sub-1'},
         {slot:'sub2',photo:'photo-sub-2',name:'name-sub-2',title:'title-sub-2'},
         {slot:'sub3',photo:'photo-sub-3',name:'name-sub-3',title:'title-sub-3'}]
         .forEach(m=>{
           const p=bySlot[m.slot]||{};
           const partner=p.partner_id?partnersById[p.partner_id]:null;
           const name=(partner&&partner.name)||p.name||document.getElementById(m.name).textContent;
           const title=partner?(partner.category||'Partner'):(p.title||document.getElementById(m.title).textContent);
           const logo=(partner&&partner.logo_url)||p.photo_url||'';
           showPhoto(m.photo,'sub',logo);
           setText(m.name,name); setText(m.title,title);
         });
      }catch(e){ console.warn('[about] org_people', e); }
    })();

    /* Partners strip */
    (async function(){
      if(!sb) return;
      const elSection = document.getElementById('partners');
      const elList = document.getElementById('partners-list');
      if(!elSection || !elList) return;
      try{
        const { data, error } = await sb
          .from('partners')
          .select('id,name,website,logo_url,logo_alt,active')
          .eq('active', true)
          .order('name', { ascending: true })
          .limit(12);
        if(error || !data?.length){ elSection.style.display='none'; return; }
        data.forEach(p=>{
          const a=document.createElement('a'); a.className='partner';
          a.href=p.website||'#'; a.target='_blank'; a.rel='noopener noreferrer'; a.title=p.name||'Partner';
          const img=document.createElement('img'); img.alt=p.logo_alt||p.name||'Partner logo'; img.src=(p.logo_url&&p.logo_url.trim())?p.logo_url:(SUPABASE_URL.replace(/\/+$/,'') + '/storage/v1/object/public/people/Revision.jpg');
          a.appendChild(img); elList.appendChild(a);
        });
      }catch(e){ console.warn('[partners] exception:', e); }
    })();

    /* ===== Skjult admin: Ejerens billede ===== */
    const $ = s=>document.querySelector(s);
    const modal = $('#admin-modal');
    const openModal = ()=>{ modal.classList.add('active'); modal.setAttribute('aria-hidden','false'); $('#adm-email')?.focus(); };
    const closeModal = ()=>{ modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); $('#adm-msg').textContent=''; };

    $('#mdl-close')?.addEventListener('click', closeModal);
    $('#mdl-cancel')?.addEventListener('click', closeModal);

    // Trigger på Ejerens billede (#photo-top): dblclick + langt tryk
    const ownerPic = document.getElementById('photo-top');
    if(ownerPic){
      // Dobbeltklik (desktop)
      ownerPic.addEventListener('dblclick', openModal);

      // Langt tryk (mobil/desktop): ~800ms
      let pressTimer=null;
      const startPress = ()=>{ clearTimeout(pressTimer); pressTimer=setTimeout(openModal, 800); };
      const cancelPress= ()=>{ clearTimeout(pressTimer); };

      ownerPic.addEventListener('mousedown', startPress);
      ownerPic.addEventListener('mouseup', cancelPress);
      ownerPic.addEventListener('mouseleave', cancelPress);

      ownerPic.addEventListener('touchstart', startPress, {passive:true});
      ownerPic.addEventListener('touchend', cancelPress);
      ownerPic.addEventListener('touchcancel', cancelPress);

      // Diskret tastatur-genvej når billedet har fokus: Alt + Enter
      ownerPic.addEventListener('keydown', (e)=>{
        if((e.altKey || e.metaKey) && e.key==='Enter'){ openModal(); }
      });
    }

    /* Login → check admins → redirect */
    async function isAdmin(session){
      if(!session) return false;
      const { data, error } = await sb.from('admins').select('id').eq('id', session.user.id).maybeSingle();
      return !!data && !error;
    }
    $('#mdl-login')?.addEventListener('click', async ()=>{
      $('#adm-msg').textContent='';
      const email=$('#adm-email').value.trim(), pass=$('#adm-pass').value;
      const { error } = await sb.auth.signInWithPassword({ email, password: pass });
      if(error){ $('#adm-msg').textContent = error.message; return; }
      const { data:{session} } = await sb.auth.getSession();
      if(!(await isAdmin(session))){ $('#adm-msg').textContent='Ingen adgang.'; await sb.auth.signOut(); return; }
      window.location.href = '/admin.html';
    });
    ['adm-email','adm-pass'].forEach(id=>{
      const el=document.getElementById(id);
      el&&el.addEventListener('keydown',e=>{ if(e.key==='Enter') $('#mdl-login').click(); });
    });
  </script>
</body>
</html>